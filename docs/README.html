<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>User Documentation</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="#ref">term</a><span>, in §N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *     -> ins/del.c### for candidate and proposed changes (amendments)
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *   - .correction for "candidate corrections"       (div, aside, details, section)
 *   - .addition   for "candidate additions"         (div, aside, details, section)
 *   - .correction.proposed for "proposed corrections" (div, aside, details, section)
 *   - .addition.proposed   for "proposed additions"   (div, aside, details, section)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Outdated warning for old specs
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/* color variables included separately for reliability */

/******************************************************************************/
/*                                    Body                                    */
/******************************************************************************/

	html {
	}

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;			  /* limit line length to 50em for readability   */
		margin: 0 auto;				/* center text within page                    */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag    */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		color: black;
		color: var(--text);
		background: white top left fixed no-repeat;
		background: var(--bg) top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em; }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border: solid var(--logo-bg);
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		background: var(--logo-bg);
		color: white;
		color: var(--logo-text);
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		background: var(--logo-active-bg);
		border-color: #c00;
		border-color: var(--logo-active-bg);
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small; }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 3;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;

			color: #707070;
			color: var(--tocnav-normal-text);
			background: white;
			background: var(--tocnav-normal-bg);
		}
		#toc-nav > a:hover,
		#toc-nav > a:focus {
			color: black;
			color: var(--tocnav-hover-text);
			background: #f8f8f8;
			background: var(--tocnav-hover-bg);
		}
		#toc-nav > a:active {
			color: #c00;
			color: var(--tocnav-active-text);
			background: white;
			background: var(--tocnav-active-bg);
		}

		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			color: black;
			color: var(--tocsidebar-text);
			background: inherit;
			background-color: #f7f8f9;
			background-color: var(--tocsidebar-bg);
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
			box-shadow: -.1em 0 .25em var(--tocsidebar-shadow) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
			color: var(--tocsidebar-heading-text);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			color: black;
			color: var(--tocsidebar-text);
			background: inherit;
			background-color: #f7f8f9;
			background-color: var(--tocsidebar-bg);
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
			box-shadow: -.1em 0 .25em var(--tocsidebar-shadow) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
			color: var(--tocsidebar-heading-text);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;	/* Inherit the font family. */
		line-height: 1.2;		/* Keep wrapped headings compact */
		hyphens: manual;		/* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		color: var(--heading-text);
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#subtitle {
		/* #subtitle is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > :not(.head) + hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		color: black;
		color: var(--hr-text);
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	border-left: 0.5em solid #DEF;
	border-left: 0.5em solid var(--algo-border);
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	 padding: .5em;
	 border: thin solid #ddd;
	 border: thin solid var(--algo-border);
	 border-radius: .5em;
	 margin: .5em calc(-0.5em - 1px);
	}
	[data-algorithm]:not(.heading) > :first-child {
	 margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	 margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	margin-left: -2em;
	}
	dl.switch {
	padding-left: 2em;
	}
	dl.switch > dt {
	text-indent: -1.5em;
	margin-top: 1em;
	}
	dl.switch > dt + dt {
	margin-top: 0;
	}
	dl.switch > dt::before {
	content: '\21AA';
	padding: 0 0.5em 0 0;
	display: inline-block;
	width: 1em;
	text-align: right;
	line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: inherit;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del {
		color: #aa0000;
		color: var(--del-text);
		background: transparent;
		background: var(--del-bg);
		text-decoration: line-through;
	}
	ins {
		color: #006100;
		color: var(--ins-text);
		background: transparent;
		background: var(--ins-bg);
		text-decoration: underline;
	}

	/* for amendments (candidate/proposed changes) */

	.amendment ins, .correction ins, .addition ins,
	ins[class^=c] {
		text-decoration-style: dotted;
	}
	.amendment del, .correction del, .addition del,
	del[class^=c] {
		text-decoration-style: dotted;
	}
	.amendment.proposed ins, .correction.proposed ins, .addition.proposed ins,
	ins[class^=c].proposed {
		text-decoration-style: double;
	}
	.amendment.proposed del, .correction.proposed del, .addition.proposed del,
	del[class^=c].proposed {
		text-decoration-style: double;
	}

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		hyphens: none;
		text-transform: none;
		text-align: left;
		text-align: start;
		font-variant: normal;
		orphans: 3;
		widows: 3;
		page-break-before: avoid;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

	/* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		color: var(--a-normal-text);
		text-decoration: none;
		border-bottom: 1px solid #707070;
		border-bottom: 1px solid var(--a-normal-underline);
		/* Need a bit of extending for it to look okay */
		padding: 0 1px 0;
		margin: 0 -1px 0;
	}
	a:visited {
		color: #034575;
		color: var(--a-visited-text);
		border-bottom-color: #bbb;
		border-bottom-color: var(--a-visited-underline);
	}

	/* Use distinguishing colors when user is interacting with the link */
	a[href]:focus,
	a[href]:hover {
		background: #f8f8f8;
		background: rgba(75%, 75%, 75%, .25);
		background: var(--a-hover-bg);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	a[href]:active {
		color: #c00;
		color: var(--a-active-text);
		border-color: #c00;
		border-color: var(--a-active-underline);
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	img, svg {
		/* Intentionally not color-scheme aware. */
		background: white;
	}

	/* For autogen numbers, add
	  .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,	.sidefigure img,	figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
		height: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em;
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em; }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote,
	.amendment, .correction, .addition {
		margin: 1em auto;
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	blockquote > :first-child,
	.note  > p:first-child,
	.issue > p:first-child,
	.amendment > p:first-child,
	.correction > p:first-child,
	.addition > p:first-child {
		margin-top: 0;
	}
	blockquote > :last-child,
	.note  > p:last-child,
	.issue > p:last-child,
	.amendment > p:last-child,
	.correction > p:last-child,
	.addition > p:last-child {
		margin-bottom: 0;
	}


	.issue::before, .issue > .marker,
	.example::before, .example > .marker,
	.note::before, .note > .marker,
	details.note > summary > .marker,
	.amendment::before, .amendment > .marker,
	details.amendment > summary > .marker,
	.addition::before, .addition > .marker,
	addition.amendment > summary > .marker,
	.correction::before, .correction > .marker,
	correction.amendment > summary > .marker
	{
		text-transform: uppercase;
		padding-right: 1em;
	}

	.example::before, .example > .marker {
		display: block;
		padding-right: 0em;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
		border-color: var(--blockquote-border);
		background: transparent;
		background: var(--blockquote-bg);
		color: currentcolor;
		color: var(--blockquote-text);
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #e05252;
		border-color: var(--issue-border);
		background: #fbe9e9;
		background: var(--issue-bg);
		color: black;
		color: var(--issue-text);
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		color: #831616;
		color: var(--issueheading-text);
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	  or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #e0cb52;
		border-color: var(--example-border);
		background: #fcfaee;
		background: var(--example-bg);
		color: black;
		color: var(--example-text);
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		color: #574b0f;
		color: var(--exampleheading-text);
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	  or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52e052;
		border-color: var(--note-border);
		background: #e9fbe9;
		background: var(--note-bg);
		color: black;
		color: var(--note-text);
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary {
		color: hsl(120, 70%, 30%);
		color: var(--noteheading-text);
	}
	/* Add .note::before { content: "Note "; } for autogen label,
	  or use class="marker" to mark up the label in source. */

	details.note[open] > summary {
		border-bottom: 1px silver solid;
		border-bottom: 1px var(--notesummary-underline) solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		border-color: var(--assertion-border);
		background: #EEE;
		background: var(--assertion-bg);
		color: black;
		color: var(--assertion-text);
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-color: var(--advisement-border);
		border-style: none solid;
		background: #fec;
		background: var(--advisement-bg);
		color: black;
		color: var(--advisement-text);
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement::before, .advisement > .marker {
		color: #b35f00;
		color: var(--advisementheading-text);
	}

/** Amendment Box *************************************************************/

	.amendment, .correction, .addition {
		border-color: #330099;
		border-color: var(--amendment-border);
		background: #F5F0FF;
		background: var(--amendment-bg);
		color: black;
		color: var(--amendment-text);
	}
	.amendment.proposed, .correction.proposed, .addition.proposed {
		border-style: solid;
		border-block-width: 0.25em;
	}
	.amendment::before, .amendment > .marker,
	details.amendment > summary::before, details.amendment > summary > .marker,
	.correction::before, .correction > .marker,
	details.correction > summary::before, details.correction > summary > .marker,
	.addition::before, .addition > .marker,
	details.addition > summary::before, details.addition > summary > .marker {
		color: #220066;
		color: var(--amendmentheading-text);
	}
	.amendment.proposed::before, .amendment.proposed > .marker,
	details.amendment.proposed > summary::before, details.amendment.proposed > summary > .marker,
	.correction.proposed::before, .correction.proposed > .marker,
	details.correction.proposed > summary::before, details.correction.proposed > summary > .marker,
	.addition.proposed::before, .addition.proposed > .marker,
	details.addition.proposed > summary::before, details.addition.proposed > summary > .marker {
		font-weight: bold;
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: hsla(40,100%,50%,0.95);
		background: var(--warning-bg);
		color: black;
		color: var(--warning-text);
		padding: .75em 1em;
		border: red;
		border: var(--warning-border);
		border-style: solid none;
		box-shadow: 0 2px 8px black;
		text-align: center;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

@media not print {
	details.annoying-warning[open] {
		position: fixed;
		left: 0;
		right: 0;
		bottom: 2em;
		z-index: 1000;
	}
}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #def;
		background: var(--def-bg);
		margin: 1.2em 0;
		border-left: 0.5em solid #8ccbf2;
		border-left: 0.5em solid var(--def-border);
		color: black;
		color: var(--def-text);
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
		border-bottom: 1px solid var(--defrow-border);
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def td.footnote {
		padding-top: 0.6em;
	}
	table.def td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		<table class="data"> highlights structural relationships in a table
		when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		Use class="complex data" for particularly complicated tables --
		(This will draw more lines: busier, but clearer.)

		Use class="long" on table cells with paragraph-like contents
		(This will adjust text alignment accordingly.)
		Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-color: var(--datacell-border);
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		border-top: 1px solid var(--datacell-border);
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		border: 1px solid var(--datacell-border);
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
		vertical-align: baseline;
		text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding-top: 0.1rem;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Reverse color scheme */
		color: black;
		color: var(--toclink-text);
		border-color: #3980b5;
		border-color: var(--toclink-underline);
	}
	.toc a:visited {
		color: black;
		color: var(--toclink-visited-text);
		border-color: #054572;
		border-color: var(--toclink-visited-underline);
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
	}
	.toc {
		line-height: 1.1em;
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li			{ font-weight: bold;   }
	.toc > li li		 { font-weight: normal; }
	.toc > li li li	  { font-size:   95%;	}
	.toc > li li li li	{ font-size:   90%;	}
	.toc > li li li li li { font-size:   85%;	}

	/* @supports not (display:grid) { */
		.toc > li			{ margin: 1.5rem 0;	}
		.toc > li li		 { margin: 0.3rem 0;	}
		.toc > li li li	  { margin-left: 2rem;   }

		/* Section numbers in a column of their own */
		.toc .secno {
			float: left;
			width: 4rem;
			white-space: nowrap;
		}
		.toc > li li li li .secno { font-size: 85%; }
		.toc > li li li li li .secno { font-size: 100%; }

		.toc li {
			clear: both;
		}

		:not(li) > .toc			 { margin-left:  5rem; }
		.toc .secno				 { margin-left: -5rem; }
		.toc > li li li .secno	  { margin-left: -7rem; }
		.toc > li li li li .secno	{ margin-left: -9rem; }
		.toc > li li li li li .secno { margin-left: -11rem; }

		/* Tighten up indentation in narrow ToCs */
		@media (max-width: 30em) {
			:not(li) > .toc			 { margin-left:  4rem; }
			.toc .secno				 { margin-left: -4rem; }
			.toc > li li li			 { margin-left:  1rem; }
			.toc > li li li .secno	  { margin-left: -5rem; }
			.toc > li li li li .secno	{ margin-left: -6rem; }
			.toc > li li li li li .secno { margin-left: -7rem; }
		}
		/* Loosen it on wide screens */
		@media screen and (min-width: 78em) {
			body:not(.toc-inline) :not(li) > .toc			 { margin-left:  4rem; }
			body:not(.toc-inline) .toc .secno				 { margin-left: -4rem; }
			body:not(.toc-inline) .toc > li li li			 { margin-left:  1rem; }
			body:not(.toc-inline) .toc > li li li .secno	  { margin-left: -5rem; }
			body:not(.toc-inline) .toc > li li li li .secno	{ margin-left: -6rem; }
			body:not(.toc-inline) .toc > li li li li li .secno { margin-left: -7rem; }
	}
	/* } */

	@supports (display:grid) and (display:contents) {
		/* Use #toc over .toc to override non-@supports rules. */
		#toc {
			display: grid;
			align-content: start;
			grid-template-columns: auto 1fr;
			grid-column-gap: 1rem;
			column-gap: 1rem;
			grid-row-gap: .6rem;
			row-gap: .6rem;
		}
		#toc h2 {
			grid-column: 1 / -1;
			margin-bottom: 0;
		}
		#toc ol,
		#toc li,
		#toc a {
			display: contents;
			/* Switch <a> to subgrid when supported */
		}
		#toc span {
			margin: 0;
		}
		#toc > .toc > li > a > span {
			/* The spans of the top-level list,
			  comprising the first items of each top-level section. */
			margin-top: 1.1rem;
		}
		#toc#toc .secno { /* Ugh, need more specificity to override base.css */
			grid-column: 1;
			width: auto;
			margin-left: 0;
		}
		#toc .content {
			grid-column: 2;
			width: auto;
			margin-right: 1rem;
		}
		#toc .content:hover,
		#toc .content:focus {
			background: rgba(75%, 75%, 75%, .25);
			background: var(--a-hover-bg);
			border-bottom: 3px solid #054572;
			border-bottom: 3px solid var(--toclink-underline);
			margin-bottom: -3px;
		}
		#toc li li li .content {
			margin-left: 1rem;
		}
		#toc li li li li .content {
			margin-left: 2rem;
		}
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index	  { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li	{ margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em; }
	ul.index dl	{ margin-top: 0; }
	ul.index dt	{ margin: .2em 0 .2em 20px;}
	ul.index dd	{ margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li span:not(.dfn-paneled) {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
			color: var(--indexinfo-text);
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		color: black;
		color: var(--indextable-hover-text);
		background: #f7f8f9;
		background: var(--indextable-hover-bg);
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/** Outdated warning **********************************************************/

.outdated-spec {
	color: black;
	color: var(--outdatedspec-text);
	background-color: rgba(0,0,0,0.5);
	background-color: var(--outdatedspec-bg);
}

.outdated-warning {
	position: fixed;
	bottom: 50%;
	left: 0;
	right: 0;
	margin: 0 auto;
	width: 50%;
	background: maroon;
	background: var(--outdated-bg);
	color: white;
	color: var(--outdated-text);
	border-radius: 1em;
	box-shadow: 0 0 1em red;
	box-shadow: 0 0 1em var(--outdated-shadow);
	padding: 2em;
	text-align: center;
	z-index: 2;
}

.outdated-warning a {
	color: currentcolor;
	background: transparent;
}

.edited-rec-warning {
	background: darkorange;
	background: var(--editedrec-bg);
	box-shadow: 0 0 1em;
}

.outdated-warning button {
	color: var(--outdated-text);
	border-radius: 1em;
	box-shadow: 0 0 1em red;
	box-shadow: 0 0 1em var(--outdated-shadow);
	padding: 2em;
	text-align: center;
	z-index: 2;
}

.outdated-warning a {
	color: currentcolor;
	background: transparent;
}

.edited-rec-warning {
	background: darkorange;
	background: var(--editedrec-bg);
	box-shadow: 0 0 1em;
}

.outdated-warning button {
	position: absolute;
	top: 0;
	right:0;
	margin: 0;
	border: 0;
	padding: 0.25em 0.5em;
	background: transparent;
	color: white;
	color: var(--outdated-text);
	font:1em sans-serif;
	text-align:center;
}

.outdated-warning span {
	display: block;
}

.outdated-collapsed {
	bottom: 0;
	border-radius: 0;
	width: 100%;
	padding: 0;
}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}

		.outdated-warning {
			position: absolute;
			border-style: solid;
			border-color: red;
		}

		.outdated-warning input {
			display: none;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge {
		/* Magic to create good item positioning:
		  "content column" is 50ems wide at max; less on smaller screens.
		  Extra space (after ToC + content) is empty on the right.

		  1. When item < content column, centers item in column.
		  2. When content < item < available, left-aligns.
		  3. When item > available, fills available + scroll bar.
		*/
		display: grid;
		grid-template-columns: minmax(0, 50em);
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			* http://lea.verou.me/2012/04/background-attachment-local/
			*
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
						top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
						top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
						top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
						white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
  <meta content="Bikeshed version 4e8dd937, updated Fri Nov 13 16:49:31 2020 -0800" name="generator">
  <link href="http://page.mi.fu-berlin.de/ghastermann/fvs-agklein-doc/" rel="canonical">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #707070;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #bbb;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-line-numbers */

:root {
    --highlight-hover-bg: rgba(0, 0, 0, .05);
}
.line-numbered {
    display: grid !important;
    grid-template-columns: min-content 1fr;
    grid-auto-flow: row;
}
.line-numbered > *,
.line-numbered::before,
.line-numbered::after {
    grid-column: 1/-1;
}
.line-no {
    grid-column: 1;
    color: gray;
}
.line {
    grid-column: 2;
}
.line:hover {
    background: var(--highlight-hover-bg);
}
.line-no[data-line]::before {
    padding: 0 .5em 0 .1em;
    content: attr(data-line);
}
.line-no[data-line-end]::after {
    padding: 0 .5em 0 .1em;
    content: attr(data-line-end);
}
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}

@media (prefers-color-scheme: dark) {
    :root {
        --highlight-hover-bg: rgba(255, 255, 255, .05);
    }
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"></p>
   <h1 class="p-name no-ref" id="title">User Documentation</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Living Document, <time class="dt-updated" datetime="2021-01-10">10 January 2021</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="http://page.mi.fu-berlin.de/ghastermann/fvs-agklein-doc/">http://page.mi.fu-berlin.de/ghastermann/fvs-agklein-doc/</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:maikel.nadolski@fu-berlin.de">Maikel Nadolski</a> (<a class="p-org org" href="https://fu-berlin.de">Freie Universität Berlin</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://creativecommons.org/publicdomain/zero/1.0/" rel="license"><img alt="CC0" src="https://licensebuttons.net/p/zero/1.0/80x15.png"></a> To the extent possible under law, the editors have waived all copyright
and related or neighboring rights to this work.
In addition, as of 10 January 2021,
the editors have made this specification available under the <a href="http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0" rel="license">Open Web Foundation Agreement Version 1.0</a>,
which is available at http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0.
Parts of this work may be from another specification document.  If so, those parts are instead covered by the license of that specification document. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This is a user documentation for the Finite Volume Solver library which is developed at AG Klein, Freie Universität Berlin. The library provides a framework to solve hyperbolic equations with finite volume methods. It assumes an external structured grid library like <a data-link-type="biblio" href="#biblio-amrex">[AMReX]</a>, <a data-link-type="biblio" href="#biblio-samrai">[SAMRAI]</a> or <a data-link-type="biblio" href="#biblio-p4est">[p4est]</a> to adaptively refine regions of interest. One of the main design philosophies is to make the numerical methods re-usable and consistent across different grid implementations. We provide some standard flux methods which can be used out-of-the-box with a large set of hyperbolic equations. Furthermore, a lot of helper classes exist to generate distributed grids for data management which simplifies and modernizes the usage of libraries like <a data-link-type="biblio" href="#biblio-amrex">[AMReX]</a> or <a data-link-type="biblio" href="#biblio-samrai">[SAMRAI]</a>. At last, this library is also capable of handling embedded boundaries in a dimensionally split setting as defined in <a data-link-type="biblio" href="#biblio-klein2009">[Klein2009]</a>.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#installation"><span class="secno">1</span> <span class="content">Installation</span></a>
     <ol class="toc">
      <li><a href="#conan-config"><span class="secno">1.1</span> <span class="content">Conan Configuration</span></a>
      <li><a href="#mpi-install"><span class="secno">1.2</span> <span class="content">MPI Installation</span></a>
      <li><a href="#cmake-install"><span class="secno">1.3</span> <span class="content">CMake Installation</span></a>
      <li>
       <a href="#build-library"><span class="secno">1.4</span> <span class="content">Building the Library</span></a>
       <ol class="toc">
        <li><a href="#useful-build-flags"><span class="secno">1.4.1</span> <span class="content">Useful build flags</span></a>
       </ol>
     </ol>
    <li>
     <a href="#code-overview"><span class="secno">2</span> <span class="content">Code Overview</span></a>
     <ol class="toc">
      <li><a href="#policy-pattern"><span class="secno">2.1</span> <span class="content">Policy Pattern</span></a>
      <li><a href="#patch-hierarchy"><span class="secno">2.2</span> <span class="content">Data Storage: PatchHierarchy</span></a>
      <li><a href="#gridding-algorithm"><span class="secno">2.3</span> <span class="content">Algorithmic Choice: GriddingAlgorithm</span></a>
      <li><a href="#data-integrator-context"><span class="secno">2.4</span> <span class="content">Data Storage: IntegratorContext</span></a>
      <li><a href="#algorithm-choice-integrator-context"><span class="secno">2.5</span> <span class="content">Algorithmic Choice: IntegratorContext</span></a>
      <li><a href="#level-integrator"><span class="secno">2.6</span> <span class="content">Algorithmic Choice: LevelIntegrator</span></a>
      <li><a href="#subcycle-solver"><span class="secno">2.7</span> <span class="content">Algorithmic Choice: SubcycleSovler</span></a>
     </ol>
    <li>
     <a href="#flux-method-framework"><span class="secno">3</span> <span class="content">Framework for defining FluxMethods</span></a>
     <ol class="toc">
      <li><a href="#cons-comp-states"><span class="secno">3.1</span> <span class="content">Equation: Conservative and Complete States</span></a>
      <li><a href="#implement-flux-method-simple"><span class="secno">3.2</span> <span class="content">Implement a new FluxMethod, the simple case</span></a>
     </ol>
    <li>
     <a href="#using-docker-to-share-and-persist-a-simulation"><span class="secno">4</span> <span class="content">Using Docker to share and persist a simulation</span></a>
     <ol class="toc">
      <li><a href="#how-to-run-an-existing-simulation"><span class="secno">4.1</span> <span class="content">How to run an existing simulation</span></a>
     </ol>
    <li><a href="#conformance"><span class="secno"></span> <span class="content"> Conformance</span></a>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script async id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
   <h2 class="heading settled" data-level="1" id="installation"><span class="secno">1. </span><span class="content">Installation</span><a class="self-link" href="#installation"></a></h2>
   <h3 class="heading settled" data-level="1.1" id="conan-config"><span class="secno">1.1. </span><span class="content">Conan Configuration</span><a class="self-link" href="#conan-config"></a></h3>
   <p>We use the C++ package manager <a href="https://conan.io">conan</a> to install dependencies for this library. <code>conan</code> is a python3 package and installable via the python package manager <code>pip3</code>. To install <code>conan</code> open a terminal and use the command</p>
<pre class="language-text highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line">> pip3 install --user conan</span></pre>
   <p>to make user-wide installation. You might need to add <code>${HOME}/.local/bin</code> to your <code>PATH</code> environment variable in case of a user-wide installation.
If you have root access on your machine you can also consider doing a system-wide installation via the command</p>
<pre class="language-text highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line">> sudo pip3 install conan</span></pre>
   <p>To test whether conan is installed type <code>conan</code> in your command line window.</p>
   <p>Expected Output:</p>
<pre class="language-text highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line">> conan</span><span class="line-no" data-line="2"></span><span class="line">Consumer commands</span><span class="line-no" data-line="3"></span><span class="line">  install    Installs the requirements specified in a recipe (conanfile.py or conanfile.txt).</span><span class="line-no" data-line="4"></span><span class="line">  config     Manages Conan configuration.</span><span class="line-no" data-line="5"></span><span class="line">  get        Gets a file or list a directory of a given reference or package.</span><span class="line-no" data-line="6"></span><span class="line">  info       Gets information about the dependency graph of a recipe.</span><span class="line-no" data-line="7"></span><span class="line">  search     Searches package recipes and binaries in the local cache or in a remote.</span><span class="line-no" data-line="8"></span><span class="line">Creator commands</span><span class="line-no" data-line="9"></span><span class="line">  new        Creates a new package recipe template with a 'conanfile.py' and optionally,</span><span class="line-no" data-line="10"></span><span class="line">             'test_package' testing files.</span><span class="line-no" data-line="11"></span><span class="line">  create     Builds a binary package for a recipe (conanfile.py).</span><span class="line-no" data-line="12"></span><span class="line">  upload     Uploads a recipe and binary packages to a remote.</span><span class="line-no" data-line="13"></span><span class="line">  export     Copies the recipe (conanfile.py &amp; associated files) to your local cache.</span><span class="line-no" data-line="14"></span><span class="line">  export-pkg Exports a recipe, then creates a package from local source and build folders.</span><span class="line-no" data-line="15"></span><span class="line">  test       Tests a package consuming it from a conanfile.py with a test() method.</span><span class="line-no" data-line="16"></span><span class="line">Package development commands</span><span class="line-no" data-line="17"></span><span class="line">  source     Calls your local conanfile.py 'source()' method.</span><span class="line-no" data-line="18"></span><span class="line">  build      Calls your local conanfile.py 'build()' method.</span><span class="line-no" data-line="19"></span><span class="line">  package    Calls your local conanfile.py 'package()' method.</span><span class="line-no" data-line="20"></span><span class="line">  editable   Manages editable packages (package that resides in the user workspace, but are</span><span class="line-no" data-line="21"></span><span class="line">             consumed as if they were in the cache).</span><span class="line-no" data-line="22"></span><span class="line">  workspace  Manages a workspace (a set of packages consumed from the user workspace that</span><span class="line-no" data-line="23"></span><span class="line">             belongs to the same project).</span><span class="line-no" data-line="24"></span><span class="line">Misc commands</span><span class="line-no" data-line="25"></span><span class="line">  profile    Lists profiles in the '.conan/profiles' folder, or shows profile details.</span><span class="line-no" data-line="26"></span><span class="line">  remote     Manages the remote list and the package recipes associated to a remote.</span><span class="line-no" data-line="27"></span><span class="line">  user       Authenticates against a remote with user/pass, caching the auth token.</span><span class="line-no" data-line="28"></span><span class="line">  imports    Calls your local conanfile.py or conanfile.txt 'imports' method.</span><span class="line-no" data-line="29"></span><span class="line">  copy       Copies conan recipes and packages to another user/channel.</span><span class="line-no" data-line="30"></span><span class="line">  remove     Removes packages or binaries matching pattern from local cache or remote.</span><span class="line-no" data-line="31"></span><span class="line">  alias      Creates and exports an 'alias package recipe'.</span><span class="line-no" data-line="32"></span><span class="line">  download   Downloads recipe and binaries to the local cache, without using settings.</span><span class="line-no" data-line="33"></span><span class="line">  inspect    Displays conanfile attributes, like name, version and options. Works locally, in</span><span class="line-no" data-line="34"></span><span class="line">             local cache and remote.</span><span class="line-no" data-line="35"></span><span class="line">  help       Shows help for a specific command.</span><span class="line-no" data-line="36"></span><span class="line">  graph      Generates and manipulates lock files.</span><span class="line-no" data-line="37"></span><span class="line"></span><span class="line-no" data-line="38"></span><span class="line">Conan commands. Type "conan &lt;command> -h" for help</span></pre>
   <p>As a first step, you have to create a <a href="https://docs.conan.io/en/latest/reference/commands/misc/profile.html">conan profile</a>, which describes which toolchain you want to use. To create an auto-detected tool-chain use the command</p>
<pre class="language-text highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line">> conan profile new default --detect</span></pre>
   <p>In the case of GCC make sure to use the C++11 ABI. Unfortunately, <code>conan</code> does not choose this by default and we have to adjust the configuration by</p>
<pre class="language-text highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line">> conan profile update settings.compiler.libcxx=libstdc++11 default</span><span class="line-no" data-line="2"></span><span class="line">> conan profile show default</span><span class="line-no" data-line="3"></span><span class="line">Configuration for profile default:</span><span class="line-no" data-line="4"></span><span class="line"></span><span class="line-no" data-line="5"></span><span class="line">[settings]</span><span class="line-no" data-line="6"></span><span class="line">os=Linux</span><span class="line-no" data-line="7"></span><span class="line">os_build=Linux</span><span class="line-no" data-line="8"></span><span class="line">arch=x86_64</span><span class="line-no" data-line="9"></span><span class="line">arch_build=x86_64</span><span class="line-no" data-line="10"></span><span class="line">compiler=gcc</span><span class="line-no" data-line="11"></span><span class="line">compiler.version=9</span><span class="line-no" data-line="12"></span><span class="line">compiler.libcxx=libstdc++11</span><span class="line-no" data-line="13"></span><span class="line">build_type=Release</span><span class="line-no" data-line="14"></span><span class="line">[options]</span><span class="line-no" data-line="15"></span><span class="line">[build_requires]</span><span class="line-no" data-line="16"></span><span class="line">[env]</span></pre>
   <p class="note" role="note"><span>Note:</span> The library needs a minimum GCC version of 7 or a minimum LLVM clang version of 5. We regularly test in our CI at GitLab GCC version 9 and clang version 8.</p>
   <p>We added some custom installation recipes which <code>conan</code> can use to install dependencies like <a data-link-type="biblio" href="#biblio-amrex">[AMReX]</a> or <a data-link-type="biblio" href="#biblio-hdf5">[HDF5]</a>. These are stored in a <code>conan</code> repository and we need to point <code>conan</code> to this repository. This is done via the command line</p>
<pre class="language-text highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line">> conan remote add gitlab https://git.imp.fu-berlin.de/api/v4/packages/conan</span><span class="line-no" data-line="2"></span><span class="line">> conan user &lt;username> -r gitlab -p &lt;api-key></span></pre>
   Hereby 
   <username> is the login name for gitlab and <api-key> is a personal <em>access token</em> provided by gitlab at git.imp.fu-berlin.de. <p>The access token can be created via the user symbol on the top right of the
gitlab interface, Settings->Access Tokens (check api).</p> <h3 class="heading settled" data-level="1.2" id="mpi-install"><span class="secno">1.2. </span><span class="content">MPI Installation</span><a class="self-link" href="#mpi-install"></a></h3> <p>Make sure to have some MPI implementation on your system such that your current <code>conan</code> profile can link against it. This can be achieved by adapting the compiler option of your profile.</p> <h3 class="heading settled" data-level="1.3" id="cmake-install"><span class="secno">1.3. </span><span class="content">CMake Installation</span><a class="self-link" href="#cmake-install"></a></h3> <p>CMake is a build generation tool and generates build configuration as Makefiles for example.</p> <p>Before we start installing all dependencies with <code>conan</code> we need to install a rather new version of <code>CMake</code>. <code>AMReX</code> requires a minimal <code>CMake</code> version of 3.14. Fortunately <code>CMake</code> is quite simple to download and binary packages can be found <a href="https://cmake.org/download/">here</a>.</p> <h3 class="heading settled" data-level="1.4" id="build-library"><span class="secno">1.4. </span><span class="content">Building the Library</span><a class="self-link" href="#build-library"></a></h3> <p>First use git and clone the library to a local directory</p> <pre class="language-text highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line">> git clone git@git.imp.fu-berlin.de:ag-klein/FiniteVolumeSolver.git</span></pre> <p>If you want to build the unit tests you need to pull <code>Catch2</code> as a git submodule. Enter the source direction and call</p> <pre class="language-text highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line">> cd FiniteVolumeSolver/</span><span class="line-no" data-line="2"></span><span class="line">./FiniteVolumeSolver> git submodule update --init</span></pre> <p>This will checkout the <code>develop</code> branch by default and create a folder named with relative path <code>./FiniteVolumeSolver</code>. Next, we create an out-of-source build directory where we want to build the library archives and example binaries.</p> <pre class="language-text highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line">./FiniteVolumeSolver> mkdir build</span><span class="line-no" data-line="2"></span><span class="line">./FiniteVolumeSolver> cd build</span><span class="line-no" data-line="3"></span><span class="line">./FiniteVolumeSolver/build> cd build</span></pre> <p>Inside the <code>build</code> directory we use conan to install the dependencies with the options which we want to use. <code>AMReX</code> for examples has the following configurable build options:</p> <pre class="language-text highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line">AMReX:eb = True|False [True] # enable embedded boundaries / cut-cells</span><span class="line-no" data-line="2"></span><span class="line">AMReX:omp = True|False [True] # enable OpenMP parallelization</span><span class="line-no" data-line="3"></span><span class="line">AMReX:dim = 1|2|3 [3] # spatial dimension used by AMReX</span></pre> <p>To install <a data-link-type="biblio" href="#biblio-amrex">[AMReX]</a> with embedded boundaries and without OpenMP support (there is no OpenMP support on Apple for example) use within the build directory</p> <pre class="language-text highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line">./FiniteVolumeSolver/build> conan install &lt;Path-to-FiniteVolumeSolver-Source-Dir> -o AMReX:dim=2 -o AMReX:omp=False</span></pre> <p>In our case</p> <pre class="language-text highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line">./FiniteVolumeSolver/build> conan install ../ -o AMReX:dim=2 -o AMReX:omp=False</span></pre> <p>This will look into the file <code>FiniteVolumeSolver/conanfile.txt</code> and tries to locally install all dependencies which are listed there. After installing these it creates a <code>conanfile.cmake</code> in the build directory which will be read by our <code>CMakeLists.txt</code> file. This, in turn, injects all necessary include and library paths which we need to build our application. Now we use <code>cmake</code> to configure our specific build, i.e.</p> <pre class="language-text highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line">./FiniteVolumeSolver/build> cmake ../</span></pre> <p>to configure a Debug build, or</p> <pre class="language-text highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line">./FiniteVolumeSolver/build> cmake ../ -DCMAKE_BUILD_TYPE=Release</span></pre> <p>for a Release build. On Linux and macOS this will create Makefiles by default which you can invoke by typing</p> <pre class="language-text highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line">./FiniteVolumeSolver/build> make</span></pre> <p>which should build all targets. For other systems, a more general call would be</p> <pre class="language-text highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line">./FiniteVolumeSolver/build> cmake --build .</span></pre> <h4 class="heading settled" data-level="1.4.1" id="useful-build-flags"><span class="secno">1.4.1. </span><span class="content">Useful build flags</span><a class="self-link" href="#useful-build-flags"></a></h4> <ul><li data-md><p>If you want to link to another python version then the default one you can pass</p> <pre class="language-text highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line">    -DPYBIND11_PYTHON_VERSION=3.8</span></pre>or directly specify the python executable by <pre class="language-text highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line">    -DPYTHON_EXECUTABLE=/path/to/python</span></pre> </li></ul> <p>If some targets fail to build feel free to raise an issue in GitLab.</p> <h2 class="heading settled" data-level="2" id="code-overview"><span class="secno">2. </span><span class="content">Code Overview</span><a class="self-link" href="#code-overview"></a></h2> <p>We use a layered library design to achieve separation of concerns.
One of the main goals is to have reusable implementations for algorithms which are independent of the concrete storage backend. 
We use namespaces to indicate the dependency on various structured grid libraries such as AMReX or SAMRAI. 
All components inside of the namespace <code>fub</code> are independent of the concrete AMR backend. Classes and functions of the namespaces <code>fub::amrex</code> or <code>fub::samrai</code> depend on their respective libraries.</p> <p>This library provides tools to write driver files which form complete applications. Each driver makes its own choices on how to handle program options, input files or its output.
You can find many example applications in the <code>examples/</code> subfolder within the Git project.
Every example composes layer for layer until a solver is built and run. 
An application needs to build up its layers in the following order</p> <ol><li data-md><p><a href="#patch-hierarchy">PatchHierarchy</a> (data storage)</p> </li><li data-md><p><a href="#gridding-algorithm">GriddingAlgorithm</a> (algorithmic choice)</p> </li><li data-md><p><a href="#data-integrator-context">IntegratorContext</a> (data storage / algorithmic choice)</p> </li><li data-md><p>one or more composed <a href="#level-integrator">LevelIntegrator</a>s (algorithmic choice)</p> </li><li data-md><p><a href="#subcycle-solver">SubcycleSolver</a> (algorithmic choice)</p> </li></ol> <p class="note" role="note"><span>Note:</span> Each layer in this list is implemented in terms of its predecessor.</p> <h3 class="heading settled" data-level="2.1" id="policy-pattern"><span class="secno">2.1. </span><span class="content">Policy Pattern</span><a class="self-link" href="#policy-pattern"></a></h3> <p>To provide customization points for the many algorithmic choices in an AMR-enabled simulation we make heavy use of the so-called <em>policy pattern</em>.</p> <blockquote> <p><strong>Wikipedia</strong>: In computer programming, the strategy pattern (also known as the policy pattern) is a behavioral software design pattern that enables selecting an algorithm at runtime. Instead of implementing a single algorithm directly, code receives run-time instructions as to which in a family of algorithms to use.</p> </blockquote> <p>For each algorithmic customization point, we define a concept, which is simply a set of syntactic requirements.
Any type which satisfies a particular policy concept can be used as a drop-in replacement for existing algorithms to adjust the method for your special needs.
The customization points are chosen to be orthogonal and thus enable them to freely concentrate on a single aspect of the method.</p> <div class="example" id="example-6d46f5a9"><a class="self-link" href="#example-6d46f5a9"></a> Any class which has a member function called <code>UpdateConservatively</code> with a sufficient function signature satisfies the policy concept for <code>TimeIntegrator&lt;IntegratorContext></code>.
This leads to a parametrization of the algorithm in terms of objects.
One could, in the case of a <code>TimeIntegrator</code> for example, have multiple implementations for different parallelization strategies, as in the following code snippet <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- n>fub</c-><c- o>::</c-><c- n>amrex</c-><c- o>::</c-><c- n>HypberbolicMethod</c-> <c- n>method</c-><c- p>{};</c-></span><span class="line-no" data-line="2"></span><span class="line"><c- k>if</c-> <c- p>(</c-><c- n>is_gpu_enabled</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="3"></span><span class="line">  <c- n>method</c-><c- p>.</c-><c- n>time_integrator</c-> </span><span class="line-no" data-line="4"></span><span class="line">      <c- o>=</c-> <c- n>fub</c-><c- o>::</c-><c- n>amrex</c-><c- o>::</c-><c- n>EulerForwardTimeIntegrator</c-><c- p>(</c-><c- n>fub</c-><c- o>::</c-><c- n>execution</c-><c- o>::</c-><c- n>gpu</c-><c- p>);</c-></span><span class="line-no" data-line="5"></span><span class="line"><c- p>}</c-> <c- k>else</c-> <c- p>{</c-></span><span class="line-no" data-line="6"></span><span class="line">  <c- n>method</c-><c- p>.</c-><c- n>time_integrator</c-> </span><span class="line-no" data-line="7"></span><span class="line">      <c- o>=</c-> <c- n>fub</c-><c- o>::</c-><c- n>amrex</c-><c- o>::</c-><c- n>EulerForwardTimeIntegrator</c-><c- p>(</c-><c- n>fub</c-><c- o>::</c-><c- n>execution</c-><c- o>::</c-><c- n>openmp</c-><c- p>);</c-></span><span class="line-no" data-line="8"></span><span class="line"><c- p>}</c-></span></pre> <p>The notion of concepts will be part of the C++ language as of the C++20 standard.
With compilers which will support C++20 concepts already, this type requirement can be expressed in the code as in</p> <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- k>template</c-> <c- o>&lt;</c-><c- k>typename</c-> <c- n>TI</c-><c- p>,</c-> <c- k>typename</c-> <c- n>IntegratorContext</c-><c- o>></c-></span><span class="line-no" data-line="2"></span><span class="line"><c- k>concept</c-> <c- n>TimeIntegrator</c-> <c- o>=</c-> <c- n>std</c-><c- o>::</c-><c- n>copy_assignable</c-><c- o>&lt;</c-><c- n>TI</c-><c- o>></c-> <c- o>&amp;&amp;</c-> <c- k>requires</c-> <c- p>(</c-></span><span class="line-no" data-line="3"></span><span class="line">    <c- n>TI</c-><c- o>&amp;</c-> <c- n>time_integrator</c-><c- p>,</c-> <c- n>IntegratorContext</c-><c- o>&amp;</c-> <c- n>context</c-><c- p>,</c-> <c- b>int</c-> <c- n>level</c-><c- p>,</c-> <c- n>Duration</c-> <c- n>dt</c-><c- p>,</c-></span><span class="line-no" data-line="4"></span><span class="line">    <c- n>Direction</c-> <c- n>dir</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="5"></span><span class="line">  <c- p>{</c-> <c- n>time_integrator</c-><c- p>.</c-><c- n>UpdateConservatively</c-><c- p>(</c-><c- n>context</c-><c- p>,</c-> <c- n>level</c-><c- p>,</c-> <c- n>dt</c-><c- p>,</c-> <c- n>dir</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="6"></span><span class="line"><c- p>};</c-></span></pre></div> <h3 class="heading settled" data-level="2.2" id="patch-hierarchy"><span class="secno">2.2. </span><span class="content">Data Storage: PatchHierarchy</span><a class="self-link" href="#patch-hierarchy"></a></h3> <p>A <code>PatchHierarchy</code> allocates simulation data for each refinement level on a <code>PatchLevel</code> and can be either generated by a <code>GriddingAlgorithm</code> or can be initialized from a checkpoint to restart a simulation. Data on a patch hierarchy shall represent a valid spatial state at some time point and does not contain a ghost cell layer.
The allocated data can be either associated to be cell-, node- or face-centered. The required data allocation is described by an object of type <code>DataDescription</code>, which is defined as</p> <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- k>struct</c-> <c- n>DataDescription</c-> <c- p>{</c-></span><span class="line-no" data-line="2"></span><span class="line">  <c- b>int</c-> <c- n>n_cell_components</c-><c- p>{</c-><c- mi>0</c-><c- p>};</c-></span><span class="line-no" data-line="3"></span><span class="line">  <c- b>int</c-> <c- n>n_node_components</c-><c- p>{</c-><c- mi>0</c-><c- p>};</c-></span><span class="line-no" data-line="4"></span><span class="line">  <c- b>int</c-> <c- n>n_face_components</c-><c- p>{</c-><c- mi>0</c-><c- p>};</c-></span><span class="line-no" data-line="5"></span><span class="line">  <c- b>int</c-> <c- n>dimension</c-><c- p>{</c-><c- n>AMREX_SPACEDIM</c-><c- p>};</c-></span><span class="line-no" data-line="6"></span><span class="line"><c- p>};</c-></span></pre> <p class="note" role="note"><span>Note:</span> A patch hierarchy does not know what the components represent. It does not have an equation object as context and does not need it. Its only responsibility is to manage a certain amount of data over multiple levels and distributed over MPI ranks.</p> <p class="note" role="note"><span>Note:</span> <a data-link-type="biblio" href="#biblio-amrex">[AMReX]</a> represents hierarchies very often as pairs of <code>(Vector&lt;MultiFab*>, Vector&lt;Geometry>)</code> where the vector is taken over the number of refinement levels. One can interpret a <code>PatchHierarchy</code> as an equivalent representation.</p> <h3 class="heading settled" data-level="2.3" id="gridding-algorithm"><span class="secno">2.3. </span><span class="content">Algorithmic Choice: GriddingAlgorithm</span><a class="self-link" href="#gridding-algorithm"></a></h3> <p>A gridding algorithm adds some algorithmic choices to the patch hierarchy which are needed for the box generation algorithms in the context of adaptive mesh refinement.
The present gridding algorithms use the <code>AmrCore</code> class from the <a data-link-type="biblio" href="#biblio-amrex">[AMReX]</a> library to generate a distributed hierarchy of index boxes. 
It owns a patch hierarchy and initializes or modifies it.
It uses a <code>TaggingMethod</code> policy object to mask cells that need additional refinement. 
In addition to the <code>TaggingMethod</code> policy, a <code>GriddingAlgorithm</code> also needs boundary and initial conditions, given by <code>BoundaryCondition</code> and <code>InitialData</code> policy objects. 
The boundary conditions are used in communication routines to fill the ghost cell layer touching the computational domain, whereas the initial conditions are only used once at the beginning of a simulation.</p> <div class="example" id="example-8c3fd61c"><a class="self-link" href="#example-8c3fd61c"></a> The following code example will create an initialized and adaptively refined patch hierarchy. <p>This example produces the following figure and can be visualized either in VisIt, Paraview or python-yt.</p> <center><img height="auto" src="img/initial_hierarchy.png" width="60%"></center> </div> <p>Copying a <code>GriddingAlgorithm</code> object will deeply copy its data and its policy objects on each MPI rank. This is useful if one wants to make a backup of the current grid state.
The <code>GriddingAlgorithm</code> provides three customization points. 
Their concepts <code>InitialData&lt;GriddingAlgorithm></code>, <code>TaggingMethod&lt;GriddingAlgorithm></code> and <code>BoundaryCondition&lt;GriddingAlgorithm></code> are defined as</p> <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- k>template</c-> <c- o>&lt;</c-><c- k>typename</c-> <c- n>I</c-><c- p>,</c-> <c- k>typename</c-> <c- n>GriddingAlgorithm</c-><c- o>></c-></span><span class="line-no" data-line="2"></span><span class="line"><c- k>concept</c-> <c- n>InitialData</c-> <c- o>=</c-> <c- n>std</c-><c- o>::</c-><c- n>copy_assignable</c-><c- o>&lt;</c-><c- n>I</c-><c- o>></c-> <c- o>&amp;&amp;</c-> </span><span class="line-no" data-line="3"></span><span class="line">    <c- k>requires</c-> <c- p>(</c-><c- k>const</c-> <c- n>I</c-><c- o>&amp;</c-> <c- n>initial_data</c-><c- p>,</c-> <c- k>const</c-> <c- n>GriddingAlgorithm</c-><c- o>&amp;</c-> <c- n>grid</c-><c- p>,</c-> <c- b>int</c-> <c- n>level</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="4"></span><span class="line">        <c- p>{</c-> <c- n>initial_data</c-><c- p>.</c-><c- n>InitializeData</c-><c- p>(</c-><c- n>grid</c-><c- p>,</c-> <c- n>level</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="5"></span><span class="line">    <c- p>}</c-></span><span class="line-no" data-line="6"></span><span class="line"></span><span class="line-no" data-line="7"></span><span class="line"><c- k>template</c-> <c- o>&lt;</c-><c- k>typename</c-> <c- n>T</c-><c- p>,</c-> <c- k>typename</c-> <c- n>GriddingAlgorithm</c-><c- o>></c-></span><span class="line-no" data-line="8"></span><span class="line"><c- k>concept</c-> <c- n>TaggingMethod</c-> <c- o>=</c-> <c- n>std</c-><c- o>::</c-><c- n>copy_assignable</c-><c- o>&lt;</c-><c- n>T</c-><c- o>></c-> <c- o>&amp;&amp;</c-> </span><span class="line-no" data-line="9"></span><span class="line">    <c- k>requires</c-> <c- p>(</c-><c- k>const</c-> <c- n>T</c-><c- o>&amp;</c-> <c- n>tagging_method</c-><c- p>,</c-> <c- o>::</c-><c- n>amrex</c-><c- o>::</c-><c- n>TagBoxArray</c-><c- o>&amp;</c-> <c- n>tags</c-><c- p>,</c-> <c- k>const</c-> <c- n>GriddingAlgorithm</c-><c- o>&amp;</c-> <c- n>grid</c-><c- p>,</c-> <c- b>int</c-> <c- n>level</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="10"></span><span class="line">        <c- p>{</c-> <c- n>tagging_method</c-><c- p>.</c-><c- n>TagCellsForRefinement</c-><c- p>(</c-><c- n>tags</c-><c- p>,</c-> <c- n>grid</c-><c- p>,</c-> <c- n>level</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="11"></span><span class="line">    <c- p>}</c-></span><span class="line-no" data-line="12"></span><span class="line"></span><span class="line-no" data-line="13"></span><span class="line"><c- k>template</c-> <c- o>&lt;</c-><c- k>typename</c-> <c- n>BC</c-><c- p>,</c-> <c- k>typename</c-> <c- n>GriddingAlgorithm</c-><c- o>></c-></span><span class="line-no" data-line="14"></span><span class="line"><c- k>concept</c-> <c- n>BoundaryCondition</c-> <c- o>=</c-> <c- n>std</c-><c- o>::</c-><c- n>copy_assignable</c-><c- o>&lt;</c-><c- n>BC</c-><c- o>></c-> <c- o>&amp;&amp;</c-> </span><span class="line-no" data-line="15"></span><span class="line">    <c- k>requires</c-> <c- p>(</c-><c- k>const</c-> <c- n>BC</c-><c- o>&amp;</c-> <c- n>boundary_condition</c-><c- p>,</c-> <c- o>::</c-><c- n>amrex</c-><c- o>::</c-><c- n>MultiFab</c-><c- o>&amp;</c-> <c- n>data</c-><c- p>,</c-> <c- k>const</c-> <c- n>GriddingAlgorithm</c-><c- o>&amp;</c-> <c- n>grid</c-><c- p>,</c-> <c- b>int</c-> <c- n>level</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="16"></span><span class="line">        <c- p>{</c-> <c- n>boundary_condition</c-><c- p>.</c-><c- n>FillBoundary</c-><c- p>(</c-><c- n>data</c-><c- p>,</c-> <c- n>grid</c-><c- p>,</c-> <c- n>level</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="17"></span><span class="line">    <c- p>}</c-></span></pre> <p>You find polymorphic value types <code>AnyInitialData&lt;GriddingAlgorithm></code>, <code>AnyTaggingMethod&lt;GriddingAlgorithm></code> and <code>AnyBoundaryCondition&lt;GriddingAlgorithm></code> in the Finite Volume Solver library to match each one of the concepts. These polymorphic types are used to store any object of a class that satisfies those concepts.</p> <div class="example" id="example-fdd86d3c"><a class="self-link" href="#example-fdd86d3c"></a> The class <code>fub::amrex::GriddingAlgorithm</code> is internally defined in something like <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- k>class</c-> <c- nc>GriddingAlgorithm</c-> <c- o>:</c-> <c- k>private</c-> <c- o>::</c-><c- n>amrex</c-><c- o>::</c-><c- n>AmrCore</c-> <c- p>{</c-></span><span class="line-no" data-line="2"></span><span class="line"><c- k>private</c-><c- o>:</c-></span><span class="line-no" data-line="3"></span><span class="line">    <c- n>PatchHierarchy</c-> <c- n>hierarchy_</c-><c- p>;</c-></span><span class="line-no" data-line="4"></span><span class="line">    <c- n>AnyInitialData</c-> <c- n>initial_data_</c-><c- p>;</c-></span><span class="line-no" data-line="5"></span><span class="line">    <c- n>AnyTaggingMethod</c-> <c- n>tagging_method_</c-><c- p>;</c-></span><span class="line-no" data-line="6"></span><span class="line">    <c- n>AnyBoundaryCondition</c-> <c- n>boundary_condition_</c-><c- p>;</c-></span><span class="line-no" data-line="7"></span><span class="line"></span><span class="line-no" data-line="8"></span><span class="line"><c- k>public</c-><c- o>:</c-></span><span class="line-no" data-line="9"></span><span class="line">    <c- d>/* etc... */</c-></span><span class="line-no" data-line="10"></span><span class="line"><c- p>};</c-></span></pre></div> <h3 class="heading settled" data-level="2.4" id="data-integrator-context"><span class="secno">2.4. </span><span class="content">Data Storage: IntegratorContext</span><a class="self-link" href="#data-integrator-context"></a></h3> <p>An <code>IntegratorContext</code> allocates, manages and provides access to additional data that is needed for every conservative AMR scheme, such as cell-centered and face-centered data arrays <strong>with ghost layers</strong>. It also manages face-centered data on the coarse-fine interface between two refinement levels.</p> <div class="example" id="example-6e74b2a6"><a class="self-link" href="#example-6e74b2a6"></a> The following code snippet shows a how to access cell and face-based data with ghost cells using the <a data-link-type="biblio" href="#biblio-amrex">[AMReX]</a> toolbox. This implements parallelization for GPU with a fallback to an MPI/OpenMP hybrid. This class satisfies the <code>TimeIntegrator&lt;fub::amrex::IntegratorContext></code> concept. <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- k>class</c-> <c- nc>GpuTimeIntegrator</c-> <c- p>{</c-></span><span class="line-no" data-line="2"></span><span class="line">  <c- c1>/// \brief This function computes a conservative time update for cells in</c-></span><span class="line-no" data-line="3"></span><span class="line">  <c- c1>/// direction dir</c-></span><span class="line-no" data-line="4"></span><span class="line">  <c- c1>///</c-></span><span class="line-no" data-line="5"></span><span class="line">  <c- c1>/// This specific implementation uses the AMReX tools to do the job</c-></span><span class="line-no" data-line="6"></span><span class="line">  <c- b>void</c-> <c- n>UpdateConservatively</c-><c- p>(</c-><c- n>IntegratorContext</c-><c- o>&amp;</c-> <c- n>context</c-><c- p>,</c-> <c- b>int</c-> <c- n>level</c-><c- p>,</c-> <c- n>Duration</c-> <c- n>dt</c-><c- p>,</c-></span><span class="line-no" data-line="7"></span><span class="line">                            <c- n>Direction</c-> <c- n>dir</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="8"></span><span class="line">    <c- k>using</c-> <c- k>namespace</c-> <c- n>amrex</c-><c- p>;</c-></span><span class="line-no" data-line="9"></span><span class="line">    <c- n>MultiFab</c-><c- o>&amp;</c-> <c- n>states</c-> <c- o>=</c-> <c- n>context</c-><c- p>.</c-><c- n>GetScratch</c-><c- p>(</c-><c- n>level</c-><c- p>);</c-></span><span class="line-no" data-line="10"></span><span class="line">    <c- k>const</c-> <c- n>MultiFab</c-><c- o>&amp;</c-> <c- n>fluxes</c-> <c- o>=</c-> <c- n>context</c-><c- p>.</c-><c- n>GetFluxes</c-><c- p>(</c-><c- n>level</c-><c- p>,</c-> <c- n>dir</c-><c- p>);</c-></span><span class="line-no" data-line="11"></span><span class="line">    <c- k>const</c-> <c- b>int</c-> <c- n>n_conservative_variables</c-> <c- o>=</c-> <c- n>context</c-><c- p>.</c-><c- n>GetNConservativeVariables</c-><c- p>();</c-></span><span class="line-no" data-line="12"></span><span class="line">    <c- k>const</c-> <c- b>double</c-> <c- n>dx</c-> <c- o>=</c-> <c- n>context</c-><c- p>.</c-><c- n>GetCellSize</c-><c- p>(</c-><c- n>level</c-><c- p>,</c-> <c- n>dir</c-><c- p>);</c-></span><span class="line-no" data-line="13"></span><span class="line">    <c- k>const</c-> <c- b>double</c-> <c- n>lambda</c-> <c- o>=</c-> <c- n>dt</c-><c- p>.</c-><c- n>count</c-><c- p>()</c-> <c- o>/</c-> <c- n>dx</c-><c- p>;</c-></span><span class="line-no" data-line="14"></span><span class="line">  <c- cp>#ifdef _OPENMP</c-></span><span class="line-no" data-line="15"></span><span class="line">  <c- cp>#pragma omp parallel if (Gpu::notInLaunchRegion())</c-></span><span class="line-no" data-line="16"></span><span class="line">  <c- cp>#endif</c-></span><span class="line-no" data-line="17"></span><span class="line">    <c- k>for</c-> <c- p>(</c-><c- n>MFIter</c-> <c- n>mfi</c-><c- p>(</c-><c- n>cells</c-><c- p>,</c-> <c- n>TilingIfNotGPU</c-><c- p>());</c-> <c- n>mfi</c-><c- p>.</c-><c- n>isValid</c-><c- p>();</c-> <c- o>++</c-><c- n>mfi</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="18"></span><span class="line">      <c- n>FArrayBox</c-><c- o>&amp;</c-> <c- n>qs</c-> <c- o>=</c-> <c- n>cells</c-><c- p>[</c-><c- n>mfi</c-><c- p>];</c-></span><span class="line-no" data-line="19"></span><span class="line">      <c- k>const</c-> <c- n>FArrayBox</c-><c- o>&amp;</c-> <c- n>fs</c-> <c- o>=</c-> <c- n>fluxes</c-><c- p>[</c-><c- n>mfi</c-><c- p>];</c-></span><span class="line-no" data-line="20"></span><span class="line">      <c- k>const</c-> <c- n>Box</c-> <c- n>cell_box</c-> <c- o>=</c-> <c- n>mfi</c-><c- p>.</c-><c- n>growntilebox</c-><c- p>();</c-></span><span class="line-no" data-line="21"></span><span class="line">      <c- n>Array4</c-><c- o>&lt;</c-><c- b>double</c-><c- o>></c-> <c- n>q</c-> <c- o>=</c-> <c- n>qs</c-><c- p>.</c-><c- n>array</c-><c- p>();</c-></span><span class="line-no" data-line="22"></span><span class="line">      <c- n>Array4</c-><c- o>&lt;</c-><c- k>const</c-> <c- b>double</c-><c- o>></c-> <c- n>f</c-> <c- o>=</c-> <c- n>fs</c-><c- p>.</c-><c- n>array</c-><c- p>();</c-></span><span class="line-no" data-line="23"></span><span class="line">      <c- n>ParallelFor</c-><c- p>(</c-><c- n>cell_box</c-><c- p>,</c-> <c- n>n_conservative_variables</c-><c- p>,</c-></span><span class="line-no" data-line="24"></span><span class="line">                  <c- p>[</c-><c- o>=</c-><c- p>]</c-> <c- n>AMREX_GPU_DEVICE</c-><c- p>(</c-><c- b>int</c-> <c- n>i</c-><c- p>,</c-> <c- b>int</c-> <c- n>j</c-><c- p>,</c-> <c- b>int</c-> <c- n>k</c-><c- p>,</c-> <c- b>int</c-> <c- n>var</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="25"></span><span class="line">                    <c- n>std</c-><c- o>::</c-><c- n>array</c-><c- o>&lt;</c-><c- b>int</c-><c- p>,</c-> <c- mi>3</c-><c- o>></c-> <c- n>iv</c-><c- p>{</c-><c- n>i</c-><c- p>,</c-> <c- n>j</c-><c- p>,</c-> <c- n>k</c-><c- p>};</c-></span><span class="line-no" data-line="26"></span><span class="line">                    <c- n>std</c-><c- o>::</c-><c- n>array</c-><c- o>&lt;</c-><c- b>int</c-><c- p>,</c-> <c- mi>3</c-><c- o>></c-> <c- n>iL</c-> <c- o>=</c-> <c- n>iv</c-><c- p>;</c-></span><span class="line-no" data-line="27"></span><span class="line">                    <c- n>std</c-><c- o>::</c-><c- n>array</c-><c- o>&lt;</c-><c- b>int</c-><c- p>,</c-> <c- mi>3</c-><c- o>></c-> <c- n>iR</c-> <c- o>=</c-> <c- n>Shift</c-><c- p>(</c-><c- n>iv</c-><c- p>,</c-> <c- n>dir</c-><c- p>,</c-> <c- mi>1</c-><c- p>);</c-></span><span class="line-no" data-line="28"></span><span class="line">                    <c- n>q</c-><c- p>(</c-><c- n>iv</c-><c- p>,</c-> <c- n>var</c-><c- p>)</c-> <c- o>=</c-> <c- n>q</c-><c- p>(</c-><c- n>iv</c-><c- p>,</c-> <c- n>var</c-><c- p>)</c-> <c- o>+</c-> <c- n>lambda</c-> <c- o>*</c-> <c- p>(</c-><c- n>f</c-><c- p>(</c-><c- n>iL</c-><c- p>,</c-> <c- n>var</c-><c- p>)</c-> <c- o>-</c-> <c- n>f</c-><c- p>(</c-><c- n>iR</c-><c- p>,</c-> <c- n>var</c-><c- p>));</c-></span><span class="line-no" data-line="29"></span><span class="line">                  <c- p>});</c-></span><span class="line-no" data-line="30"></span><span class="line">    <c- p>}</c-></span><span class="line-no" data-line="31"></span><span class="line">  <c- p>}</c-></span><span class="line-no" data-line="32"></span><span class="line"><c- p>};</c-></span></pre></div> <p>In addition to managing the additional data, every integrator context defines a comprehensive list of functions to deal with the various data locations. The <code>IntegratorContext</code> concept is defined by</p> <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- k>template</c-> <c- o>&lt;</c-><c- k>typename</c-> <c- n>I</c-><c- o>></c-></span><span class="line-no" data-line="2"></span><span class="line"><c- k>concept</c-> <c- n>IntegratorContext</c-> <c- o>=</c-> <c- n>std</c-><c- o>::</c-><c- n>copy_assignable</c-><c- o>&lt;</c-><c- n>I</c-><c- o>></c-> <c- o>&amp;&amp;</c-> <c- k>requires</c-> <c- p>(</c-></span><span class="line-no" data-line="3"></span><span class="line">      <c- n>I</c-><c- o>&amp;</c-> <c- n>integrator_context</c-><c- p>,</c-> <c- b>int</c-> <c- n>level</c-><c- p>,</c-> <c- n>Duration</c-> <c- n>dt</c-><c- p>,</c-> <c- n>Direction</c-> <c- n>dir</c-><c- p>,</c-></span><span class="line-no" data-line="4"></span><span class="line">      <c- b>double</c-> <c- n>scale</c-><c- p>,</c-> <c- n>BoundaryCondition</c-><c- o>&amp;</c-> <c- n>bc</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="5"></span><span class="line">  <c- c1>// Access PatchLevel Data</c-></span><span class="line-no" data-line="6"></span><span class="line">  <c- p>{</c-> <c- n>integrator_context</c-><c- p>.</c-><c- n>GetGriddingAlgorithm</c-><c- p>()</c-> <c- p>};</c-></span><span class="line-no" data-line="7"></span><span class="line">  <c- p>{</c-> <c- n>integrator_context</c-><c- p>.</c-><c- n>GetData</c-><c- p>(</c-><c- n>level</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="8"></span><span class="line">  <c- p>{</c-> <c- n>integrator_context</c-><c- p>.</c-><c- n>GetScratch</c-><c- p>(</c-><c- n>level</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="9"></span><span class="line">  <c- p>{</c-> <c- n>integrator_context</c-><c- p>.</c-><c- n>GetFluxes</c-><c- p>(</c-><c- n>level</c-><c- p>,</c-> <c- n>dir</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="10"></span><span class="line"></span><span class="line-no" data-line="11"></span><span class="line">  <c- c1>// Coarse-fine interface interaction</c-></span><span class="line-no" data-line="12"></span><span class="line">  <c- p>{</c-> <c- n>integrator_context</c-><c- p>.</c-><c- n>ApplyFluxCorrection</c-><c- p>(</c-><c- n>level</c-><c- p>,</c-> <c- n>level</c-> <c- o>-</c-> <c- mi>1</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="13"></span><span class="line">  <c- p>{</c-> <c- n>integrator_context</c-><c- p>.</c-><c- n>ResetCoarseFineFluxes</c-><c- p>(</c-><c- n>level</c-><c- p>,</c-> <c- n>level</c-> <c- o>-</c-> <c- mi>1</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="14"></span><span class="line">  <c- p>{</c-> <c- n>integrator_context</c-><c- p>.</c-><c- n>AccumulateCoarseFineFluxes</c-><c- p>(</c-><c- n>level</c-><c- p>,</c-> <c- n>scale</c-><c- p>,</c-> <c- n>dir</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="15"></span><span class="line"></span><span class="line-no" data-line="16"></span><span class="line">  <c- c1>// Action on scratch</c-></span><span class="line-no" data-line="17"></span><span class="line">  <c- p>{</c-> <c- n>integrator_context</c-><c- p>.</c-><c- n>CoarsenConservatively</c-><c- p>(</c-><c- n>level</c-><c- p>,</c-> <c- n>level</c-> <c- o>-</c-> <c- mi>1</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="18"></span><span class="line">  <c- p>{</c-> <c- n>integrator_context</c-><c- p>.</c-><c- n>CompleteFromCons</c-><c- p>(</c-><c- n>level</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="19"></span><span class="line"></span><span class="line-no" data-line="20"></span><span class="line">  <c- c1>// Copy data</c-></span><span class="line-no" data-line="21"></span><span class="line">  <c- p>{</c-> <c- n>integrator_context</c-><c- p>.</c-><c- n>CopyDataToScratch</c-><c- p>(</c-><c- n>level</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="22"></span><span class="line">  <c- p>{</c-> <c- n>integrator_context</c-><c- p>.</c-><c- n>CopyScratchToData</c-><c- p>(</c-><c- n>level</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="23"></span><span class="line"></span><span class="line-no" data-line="24"></span><span class="line">  <c- c1>// Fill ghost layers within scratch</c-></span><span class="line-no" data-line="25"></span><span class="line">  <c- p>{</c-> <c- n>integrator_context</c-><c- p>.</c-><c- n>FillGhostLayerTwoLevels</c-><c- p>(</c-><c- n>level</c-><c- p>,</c-> <c- n>bc</c-><c- p>,</c-> <c- n>level</c-> <c- o>-</c-> <c- mi>1</c-><c- p>,</c-> <c- n>bc</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="26"></span><span class="line">  <c- p>{</c-> <c- n>integrator_context</c-><c- p>.</c-><c- n>FillGhostLayerTwoLevels</c-><c- p>(</c-><c- n>level</c-><c- p>,</c-> <c- n>level</c-> <c- o>-</c-> <c- mi>1</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="27"></span><span class="line">  <c- p>{</c-> <c- n>integrator_context</c-><c- p>.</c-><c- n>FillGhostLayerSingleLevel</c-><c- p>(</c-><c- n>level</c-><c- p>,</c-> <c- n>bc</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="28"></span><span class="line">  <c- p>{</c-> <c- n>integrator_context</c-><c- p>.</c-><c- n>FillGhostLayerSingleLevel</c-><c- p>(</c-><c- n>level</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="29"></span><span class="line"></span><span class="line-no" data-line="30"></span><span class="line">  <c- c1>// Reallocate internal data from level </c-></span><span class="line-no" data-line="31"></span><span class="line">  <c- p>{</c-> <c- n>integrator_context</c-><c- p>.</c-><c- n>ResetHierarchyConfiguration</c-><c- p>(</c-><c- n>level</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="32"></span><span class="line"><c- p>};</c-></span></pre> <p>This is the minimum amount of functions needed to build common conservative AMR schemes on top of an AMR library like <a data-link-type="biblio" href="#biblio-amrex">[AMReX]</a> or <a data-link-type="biblio" href="#biblio-samrai">[SAMRAI]</a>. The implementation of an <code>IntegratorContext</code> will, in general, be very library-specific. The layers after the <code>IntegratorContext</code> describe parts of the AMR time integration which are implemented on those concepts only.</p> <p>Nevertheless, we still refine this concept to better fit the dimensionally split time integration.</p> <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- k>template</c-> <c- o>&lt;</c-><c- k>typename</c-> <c- n>I</c-><c- o>></c-></span><span class="line-no" data-line="2"></span><span class="line"><c- k>concept</c-> <c- n>DimensionalSplitIntegratorContext</c-> <c- o>=</c-> <c- n>IntegratorContext</c-><c- o>&lt;</c-><c- n>I</c-><c- o>></c-> <c- o>&amp;&amp;</c-> <c- k>requires</c-> <c- p>(</c-></span><span class="line-no" data-line="3"></span><span class="line">      <c- n>I</c-><c- o>&amp;</c-> <c- n>integrator_context</c-><c- p>,</c-> <c- b>int</c-> <c- n>level</c-><c- p>,</c-> <c- n>Duration</c-> <c- n>dt</c-><c- p>,</c-> <c- n>Direction</c-> <c- n>dir</c-><c- p>,</c-></span><span class="line-no" data-line="4"></span><span class="line">      <c- b>double</c-> <c- n>scale</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="5"></span><span class="line">  <c- p>{</c-> <c- n>integrator_context</c-><c- p>.</c-><c- n>ComputeNumericFluxes</c-><c- p>(</c-><c- n>level</c-><c- p>,</c-> <c- n>dt</c-><c- p>,</c-> <c- n>dir</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="6"></span><span class="line">  <c- p>{</c-> <c- n>integrator_context</c-><c- p>.</c-><c- n>ComputeStableDt</c-><c- p>(</c-><c- n>level</c-><c- p>,</c-> <c- n>dir</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="7"></span><span class="line">  <c- p>{</c-> <c- n>integrator_context</c-><c- p>.</c-><c- n>UpdateConservatively</c-><c- p>(</c-><c- n>level</c-><c- p>,</c-> <c- n>dir</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="8"></span><span class="line"><c- p>};</c-></span></pre> <p>Each integrator context which is currently implemented satisfies the <code>DimensionalSplitIntegratorContext</code>.
The functions <code>ComputeStableDt</code>, <code>ComputeNumericFluxes</code>, <code>UpdateConservatively</code> and <code>CompleteFromCons</code> are customization points for those imlpementations. I. e. one needs to provide objects for the policy concepts <code>FluxMethod&lt;IntegratorContext></code>, <code>TimeIntegrator&lt;IntegratorContext></code> and <code>CompleteFromConsCalculation&lt;IntegratorContext></code> to define the behaviour of those functions.</p> <p>The list of the currently implemented integrator contexts is</p> <ul><li data-md><p><code>fub::amrex::IntegratorContext</code></p> </li><li data-md><p><code>fub::amrex::CompressibleAdvectionIntegratorContext</code></p> </li><li data-md><p><code>fub::amrex::cutcell::IntegratorContext</code></p> </li><li data-md><p><code>fub::amrex::MultiBlockIntegratorContext</code></p> </li><li data-md><p><code>fub::samrai::IntegratorContext</code></p> </li></ul> <p>The <code>MultiBlockIntegratorContext</code> class is special, because it is composed of two vectors <code>std::vector&lt;fub::amrex::IntegratorContext></code> and <code>std::vector&lt;fub::amrex::cutcell::IntegratorContext></code> where each integrator context describes a computational domain. Instead of defining policy objects for the composed context one provides them for each member context.</p> <h3 class="heading settled" data-level="2.5" id="algorithm-choice-integrator-context"><span class="secno">2.5. </span><span class="content">Algorithmic Choice: IntegratorContext</span><a class="self-link" href="#algorithm-choice-integrator-context"></a></h3> <p>We now describe the customization points for an integrator context.
Its concepts <code>FluxMethod&lt;IntegratorContext></code>, <code>TimeIntegrator&lt;IntegratorContext></code> and <code>CompleteFromConsCalculation&lt;IntegratorContext></code> are defined as</p> <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- k>template</c-> <c- o>&lt;</c-><c- k>typename</c-> <c- n>FM</c-><c- p>,</c-> <c- k>typename</c-> <c- n>IntegratorContext</c-><c- o>></c-></span><span class="line-no" data-line="2"></span><span class="line"><c- k>concept</c-> <c- n>FluxMethod</c-> <c- o>=</c-> <c- n>std</c-><c- o>::</c-><c- n>copy_assignable</c-><c- o>&lt;</c-><c- n>FM</c-><c- o>></c-> <c- o>&amp;&amp;</c-> <c- k>requires</c-> <c- p>(</c-></span><span class="line-no" data-line="3"></span><span class="line">    <c- n>FM</c-><c- o>&amp;</c-> <c- n>flux_method</c-><c- p>,</c-> <c- n>IntegratorContext</c-><c- o>&amp;</c-> <c- n>context</c-><c- p>,</c-> <c- b>int</c-> <c- n>level</c-><c- p>,</c-> <c- n>Duration</c-> <c- n>dt</c-><c- p>,</c-></span><span class="line-no" data-line="4"></span><span class="line">    <c- n>Direction</c-> <c- n>dir</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="5"></span><span class="line">  <c- p>{</c-> <c- n>flux_method</c-><c- p>.</c-><c- n>ComputeNumericFlux</c-><c- p>(</c-><c- n>context</c-><c- p>,</c-> <c- n>level</c-><c- p>,</c-> <c- n>dt</c-><c- p>,</c-> <c- n>dir</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="6"></span><span class="line">  <c- p>{</c-> <c- n>flux_method</c-><c- p>.</c-><c- n>ComputeStableDt</c-><c- p>(</c-><c- n>context</c-><c- p>,</c-> <c- n>level</c-><c- p>,</c-> <c- n>dir</c-><c- p>)</c-> <c- p>}</c-> <c- o>-></c-> <c- n>Duration</c-><c- p>;</c-></span><span class="line-no" data-line="7"></span><span class="line">  <c- p>{</c-> <c- n>FM</c-><c- o>::</c-><c- n>GetStencilSize</c-><c- p>()</c-> <c- p>}</c-> <c- o>-></c-> <c- n>std</c-><c- o>::</c-><c- n>integral_constant</c-><c- o>&lt;</c-><c- b>int</c-><c- p>,</c-> <c- n>StencilSize</c-><c- o>></c-><c- p>;</c-></span><span class="line-no" data-line="8"></span><span class="line"><c- p>};</c-></span><span class="line-no" data-line="9"></span><span class="line"></span><span class="line-no" data-line="10"></span><span class="line"><c- k>template</c-> <c- o>&lt;</c-><c- k>typename</c-> <c- n>TI</c-><c- p>,</c-> <c- k>typename</c-> <c- n>IntegratorContext</c-><c- o>></c-></span><span class="line-no" data-line="11"></span><span class="line"><c- k>concept</c-> <c- n>TimeIntegrator</c-> <c- o>=</c-> <c- n>std</c-><c- o>::</c-><c- n>copy_assignable</c-><c- o>&lt;</c-><c- n>TI</c-><c- o>></c-> <c- o>&amp;&amp;</c-> <c- k>requires</c-> <c- p>(</c-></span><span class="line-no" data-line="12"></span><span class="line">    <c- n>TI</c-><c- o>&amp;</c-> <c- n>time_integrator</c-><c- p>,</c-> <c- n>IntegratorContext</c-><c- o>&amp;</c-> <c- n>context</c-><c- p>,</c-> <c- b>int</c-> <c- n>level</c-><c- p>,</c-> <c- n>Duration</c-> <c- n>dt</c-><c- p>,</c-></span><span class="line-no" data-line="13"></span><span class="line">    <c- n>Direction</c-> <c- n>dir</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="14"></span><span class="line">  <c- p>{</c-> <c- n>time_integrator</c-><c- p>.</c-><c- n>UpdateConservatively</c-><c- p>(</c-><c- n>context</c-><c- p>,</c-> <c- n>level</c-><c- p>,</c-> <c- n>dt</c-><c- p>,</c-> <c- n>dir</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="15"></span><span class="line"><c- p>};</c-></span><span class="line-no" data-line="16"></span><span class="line"></span><span class="line-no" data-line="17"></span><span class="line"><c- k>template</c-> <c- o>&lt;</c-><c- k>typename</c-> <c- n>R</c-><c- p>,</c-> <c- k>typename</c-> <c- n>IntegratorContext</c-><c- o>></c-></span><span class="line-no" data-line="18"></span><span class="line"><c- k>concept</c-> <c- n>CompleteFromConsCalculation</c-> <c- o>=</c-> <c- n>std</c-><c- o>::</c-><c- n>copy_assignable</c-><c- o>&lt;</c-><c- n>R</c-><c- o>></c-> <c- o>&amp;&amp;</c-> <c- k>requires</c-><c- p>(</c-></span><span class="line-no" data-line="19"></span><span class="line">    <c- n>R</c-><c- o>&amp;</c-> <c- n>reconstruct</c-><c- p>,</c-> <c- n>IntegratorContext</c-><c- o>&amp;</c-> <c- n>context</c-><c- p>,</c-> <c- b>int</c-> <c- n>level</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="20"></span><span class="line">  <c- p>{</c-> <c- n>reconstruct</c-><c- p>.</c-><c- n>CompleteFromCons</c-><c- p>(</c-><c- n>context</c-><c- p>,</c-> <c- n>level</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="21"></span><span class="line"><c- p>};</c-></span></pre> <p>The member function <code>ComputeStableDt</code> shall return a time step size \( \Delta t \) such that the CFL condition for the time integration is satisfied.
The <code>ComputeNumericFluxes</code> shall fill the face-centered flux arrays in the specified direction which will be used by the <code>TimeIntegrator</code> to update the conservative state variables.</p> <p>The <code>TimeIntegrator</code> provides the usual conservative scheme for cell-based time updates</p> <p>\[  u^{n+1}_i = u^n_i + \frac{\Delta t}{\Delta x} \left( F^n_{i - \frac 12} - F^n_{i + \frac 12} \right). \]</p> <p>The numerical fluxes \( F^n_i \) in this update denote the fluxes on the faces of the specified direction and are computed by the <code>FluxMethod</code> which is configured for this integrator context.</p> <p>An AMR integration scheme may use the <code>CompleteFromConsCalculation</code> policy object whenever it changes the conservative variables to establish a valid state across all fields in the patch hierarchy.</p> <p>We collect the three customization points for the <code>IntegratorContext</code> in a class which we call <code>HyperbolicMethod&lt;IntegratorContext></code>.
It is defined as</p> <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- k>template</c-> <c- o>&lt;</c-><c- k>typename</c-> <c- n>IntegratorContext</c-><c- o>></c-></span><span class="line-no" data-line="2"></span><span class="line"><c- k>struct</c-> <c- n>HyperbolicMethod</c-> <c- p>{</c-></span><span class="line-no" data-line="3"></span><span class="line">  <c- n>AnyFluxMethod</c-><c- o>&lt;</c-><c- n>IntegratorContext</c-><c- o>></c-> <c- n>flux_method</c-><c- p>;</c-></span><span class="line-no" data-line="4"></span><span class="line">  <c- n>AnyTimeIntegrator</c-><c- o>&lt;</c-><c- n>IntegratorContext</c-><c- o>></c-> <c- n>time_integrator</c-><c- p>;</c-></span><span class="line-no" data-line="5"></span><span class="line">  <c- n>AnyCompleteFromConsCalculation</c-><c- o>&lt;</c-><c- n>IntegratorContext</c-><c- o>></c-> <c- n>reconstruct</c-><c- p>;</c-></span><span class="line-no" data-line="6"></span><span class="line"><c- p>};</c-></span></pre> <div class="example" id="example-d901a5e6"><a class="self-link" href="#example-d901a5e6"></a> To construct an <code>IntegratorContext</code> object one needs to provide a <code>GriddingAlgorithm</code> and a <code>HyperbolicMethod</code>.
The following code snippet shows how a concrete integrator context might be constructed in a driver file. <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- b>void</c-> <c- nf>MyMain</c-><c- p>(</c-><c- k>const</c-> <c- n>fub</c-><c- o>::</c-><c- n>ProgramOptions</c-><c- o>&amp;</c-> <c- n>opts</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="2"></span><span class="line">  <c- n>std</c-><c- o>::</c-><c- n>chrono</c-><c- o>::</c-><c- n>steady_clock</c-><c- o>::</c-><c- n>time_point</c-> <c- n>wall_time_reference</c-> <c- o>=</c-></span><span class="line-no" data-line="3"></span><span class="line">      <c- n>std</c-><c- o>::</c-><c- n>chrono</c-><c- o>::</c-><c- n>steady_clock</c-><c- o>::</c-><c- n>now</c-><c- p>();</c-></span><span class="line-no" data-line="4"></span><span class="line"></span><span class="line-no" data-line="5"></span><span class="line">  <c- n>fub</c-><c- o>::</c-><c- n>amrex</c-><c- o>::</c-><c- n>ScopeGuard</c-> <c- n>guard</c-><c- p>{};</c-></span><span class="line-no" data-line="6"></span><span class="line"></span><span class="line-no" data-line="7"></span><span class="line">  <c- n>fub</c-><c- o>::</c-><c- n>Advection2d</c-> <c- n>equation</c-><c- p>{{</c-><c- mf>1.0</c-><c- p>,</c-> <c- mf>1.0</c-><c- p>}};</c-></span><span class="line-no" data-line="8"></span><span class="line">  <c- n>fub</c-><c- o>::</c-><c- n>SeverityLogger</c-> <c- n>log</c-> <c- o>=</c-> <c- n>fub</c-><c- o>::</c-><c- n>GetInfoLogger</c-><c- p>();</c-></span><span class="line-no" data-line="9"></span><span class="line"></span><span class="line-no" data-line="10"></span><span class="line">  <c- n>fub</c-><c- o>::</c-><c- n>amrex</c-><c- o>::</c-><c- n>CartesianGridGeometry</c-> <c- n>geometry</c-> <c- o>=</c-> <c- n>fub</c-><c- o>::</c-><c- n>GetOptions</c-><c- p>(</c-><c- n>opts</c-><c- p>,</c-> <c- s>"GridGeometry"</c-><c- p>);</c-></span><span class="line-no" data-line="11"></span><span class="line">  <c- n>BOOST_LOG</c-><c- p>(</c-><c- n>log</c-><c- p>)</c-> <c- o>&lt;&lt;</c-> <c- s>"GridGeometry:"</c-><c- p>;</c-></span><span class="line-no" data-line="12"></span><span class="line">  <c- n>geometry</c-><c- p>.</c-><c- n>Print</c-><c- p>(</c-><c- n>log</c-><c- p>);</c-></span><span class="line-no" data-line="13"></span><span class="line"></span><span class="line-no" data-line="14"></span><span class="line">  <c- n>fub</c-><c- o>::</c-><c- n>amrex</c-><c- o>::</c-><c- n>PatchHierarchyOptions</c-> <c- n>hier_opts</c-> <c- o>=</c-> <c- n>fub</c-><c- o>::</c-><c- n>GetOptions</c-><c- p>(</c-><c- n>opts</c-><c- p>,</c-> <c- s>"PatchHierarchy"</c-><c- p>);</c-></span><span class="line-no" data-line="15"></span><span class="line">  <c- n>BOOST_LOG</c-><c- p>(</c-><c- n>log</c-><c- p>)</c-> <c- o>&lt;&lt;</c-> <c- s>"PatchHierarchy:"</c-><c- p>;</c-></span><span class="line-no" data-line="16"></span><span class="line">  <c- n>hier_opts</c-><c- p>.</c-><c- n>Print</c-><c- p>(</c-><c- n>log</c-><c- p>);</c-></span><span class="line-no" data-line="17"></span><span class="line"> </span><span class="line-no" data-line="18"></span><span class="line">  <c- k>using</c-> <c- n>State</c-> <c- o>=</c-> <c- n>fub</c-><c- o>::</c-><c- n>Advection2d</c-><c- o>::</c-><c- n>Complete</c-><c- p>;</c-></span><span class="line-no" data-line="19"></span><span class="line">  <c- n>fub</c-><c- o>::</c-><c- n>amrex</c-><c- o>::</c-><c- n>GradientDetector</c-> <c- n>gradient</c-><c- p>{</c-><c- n>equation</c-><c- p>,</c-></span><span class="line-no" data-line="20"></span><span class="line">                                        <c- n>std</c-><c- o>::</c-><c- n>pair</c-><c- p>{</c-><c- o>&amp;</c-><c- n>State</c-><c- o>::</c-><c- n>mass</c-><c- p>,</c-> <c- mf>1e-3</c-><c- p>}};</c-></span><span class="line-no" data-line="21"></span><span class="line"></span><span class="line-no" data-line="22"></span><span class="line">  <c- n>std</c-><c- o>::</c-><c- n>shared_ptr</c-> <c- n>grid</c-> <c- o>=</c-> <c- n>std</c-><c- o>::</c-><c- n>make_shared</c-><c- o>&lt;</c-><c- n>fub</c-><c- o>::</c-><c- n>amrex</c-><c- o>::</c-><c- n>GriddingAlgorithm</c-><c- o>></c-><c- p>(</c-></span><span class="line-no" data-line="23"></span><span class="line">      <c- n>fub</c-><c- o>::</c-><c- n>amrex</c-><c- o>::</c-><c- n>PatchHierarchy</c-><c- p>(</c-><c- n>equation</c-><c- p>,</c-> <c- n>geometry</c-><c- p>,</c-> <c- n>hier_opts</c-><c- p>),</c-> <c- n>CircleData</c-><c- p>{},</c-></span><span class="line-no" data-line="24"></span><span class="line">      <c- n>fub</c-><c- o>::</c-><c- n>amrex</c-><c- o>::</c-><c- n>TagAllOf</c-><c- p>(</c-><c- n>gradient</c-><c- p>,</c-> <c- n>fub</c-><c- o>::</c-><c- n>amrex</c-><c- o>::</c-><c- n>TagBuffer</c-><c- p>(</c-><c- mi>2</c-><c- p>)));</c-></span><span class="line-no" data-line="25"></span><span class="line">  <c- n>grid</c-><c- o>-></c-><c- n>InitializeHierarchy</c-><c- p>(</c-><c- mf>0.0</c-><c- p>);</c-></span><span class="line-no" data-line="26"></span><span class="line"></span><span class="line-no" data-line="27"></span><span class="line">  <c- n>fub</c-><c- o>::</c-><c- n>amrex</c-><c- o>::</c-><c- n>HyperbolicMethod</c-> <c- n>method</c-><c- p>{</c-></span><span class="line-no" data-line="28"></span><span class="line">      <c- n>fub</c-><c- o>::</c-><c- n>amrex</c-><c- o>::</c-><c- n>FluxMethodAdapter</c-><c- p>(</c-><c- n>fub</c-><c- o>::</c-><c- n>GodunovMethod</c-><c- p>{</c-><c- n>equation</c-><c- p>}),</c-></span><span class="line-no" data-line="29"></span><span class="line">      <c- n>fub</c-><c- o>::</c-><c- n>amrex</c-><c- o>::</c-><c- n>EulerForwardTimeIntegrator</c-><c- p>(),</c-> <c- n>fub</c-><c- o>::</c-><c- n>amrex</c-><c- o>::</c-><c- n>NoReconstruction</c-><c- p>{}};</c-></span><span class="line-no" data-line="30"></span><span class="line"></span><span class="line-no" data-line="31"></span><span class="line">  <c- n>fub</c-><c- o>::</c-><c- n>amrex</c-><c- o>::</c-><c- n>IntegratorContext</c-> <c- n>context</c-><c- p>(</c-><c- n>grid</c-><c- p>,</c-> <c- n>method</c-><c- p>);</c-></span><span class="line-no" data-line="32"></span><span class="line">  </span><span class="line-no" data-line="33"></span><span class="line">  <c- c1>// Now further use the context to do some things...</c-></span><span class="line-no" data-line="34"></span><span class="line"><c- p>}</c-></span></pre></div> <p>In addition to computing the mathematical correct formula, an object that satisfies <code>FluxMethod&lt;IntegratorContext></code> needs to repeat the logic of how to parallelize and how to iterate over the multi-dimensional index space.
We recognize that these are two orthogonal concerns which are both hard to get right. 
To ease the burden for authors of a <code>FluxMethod</code> we introduced some helper classes which separate these concerns. They will be discussed in more detail in <a href="#flux-method-framework">Chapter 3</a>.</p> <h3 class="heading settled" data-level="2.6" id="level-integrator"><span class="secno">2.6. </span><span class="content">Algorithmic Choice: LevelIntegrator</span><a class="self-link" href="#level-integrator"></a></h3> <p>Level integrators have the task to advance the solution in time for a single refinement level only.
They will be used by larger subcycle schemes which may, in general, do smaller time steps on finer refinement levels.
We define the concept <code>LevelIntegrator</code> such that it provides two functions <code>AdvanceLevelNonRecursively</code> and <code>ComputeStableDt</code>.</p> <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- k>template</c-> <c- o>&lt;</c-><c- k>typename</c-> <c- n>L</c-><c- o>></c-></span><span class="line-no" data-line="2"></span><span class="line"><c- k>concept</c-> <c- n>LevelIntegrator</c-> <c- o>=</c-> <c- n>std</c-><c- o>::</c-><c- n>copy_assignable</c-><c- o>&lt;</c-><c- n>L</c-><c- o>></c-> <c- o>&amp;&amp;</c-> <c- k>requires</c-> <c- p>(</c-><c- k>const</c-> <c- n>L</c-><c- o>&amp;</c-> <c- n>level_integrator</c-><c- p>,</c-> <c- b>int</c-> <c- n>level</c-><c- p>,</c-> <c- n>Duration</c-> <c- n>dt</c-><c- p>,</c-> <c- n>std</c-><c- o>::</c-><c- n>pair</c-><c- o>&lt;</c-><c- b>int</c-><c- p>,</c-> <c- b>int</c-><c- o>></c-> <c- n>subcycle</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="3"></span><span class="line">  <c- p>{</c-> <c- n>level_integrator</c-><c- p>.</c-><c- n>AdvanceLevelNonRecursively</c-><c- p>(</c-><c- n>level</c-><c- p>,</c-> <c- n>dt</c-><c- p>,</c-> <c- n>subcycle</c-><c- p>)</c-> <c- p>}</c-> <c- o>-></c-> <c- n>Result</c-><c- o>&lt;</c-><c- b>void</c-><c- p>,</c-> <c- n>TimeStepTooLarge</c-><c- o>></c-><c- p>;</c-></span><span class="line-no" data-line="4"></span><span class="line">  <c- p>{</c-> <c- n>level_integrator</c-><c- p>.</c-><c- n>ComputeStableDt</c-><c- p>(</c-><c- n>level</c-><c- p>)</c-> <c- p>}</c-> <c- o>-></c-> <c- n>Duration</c-><c- p>;</c-></span><span class="line-no" data-line="5"></span><span class="line"><c- p>};</c-></span></pre> <p>The name <code>AdvanceLevelNonRecursively</code> emphasizes that this function will be called within a recursive subcycle algorithm.
We call level integrators which provide an integrator context <code>HyperbolicSystemLevelIntegrator</code>.
An integrator context extents level integrators with functions such as <code>ApplyFluxCorrection</code>, <code>CoarsenConservatively</code> or <code>CompleteFromCons</code>.
These additional functions will be used in a subcycle algorithm to maintain the conservation of the solution across refinement levels.</p> <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- k>template</c-> <c- o>&lt;</c-><c- k>typename</c-> <c- n>HS</c-><c- o>></c-></span><span class="line-no" data-line="2"></span><span class="line"><c- k>concept</c-> <c- n>HyperbolicSystemLevelIntegrator</c-> <c- o>=</c-> <c- n>LevelIntegrator</c-><c- o>&lt;</c-><c- n>S</c-><c- o>></c-> <c- o>&amp;&amp;</c-> <c- k>requires</c-> <c- p>(</c-><c- k>const</c-> <c- n>L</c-><c- o>&amp;</c-> <c- n>level_integrator</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="3"></span><span class="line">  <c- c1>// Access underlying data storage implementation</c-></span><span class="line-no" data-line="4"></span><span class="line">  <c- p>{</c-> <c- n>level_integrator</c-><c- p>.</c-><c- n>GetIntegratorContext</c-><c- p>()</c-> <c- p>}</c-> <c- o>-></c-> <c- n>IntegratorContext</c-><c- p>;</c-></span><span class="line-no" data-line="5"></span><span class="line"><c- p>};</c-></span></pre> <p>This library includes currently the following list of level integrators</p> <ul><li data-md><p><code>DimensionalSplitLevelIntegrator</code> (satisfies <code>HyperbolicSystemLevelIntegrator</code>)</p> </li><li data-md><p><code>SystemSourceLevelIntegrator</code> (satisfies <code>HyperboilcSystemLevelIntegrator</code>)</p> </li><li data-md><p><code>BK19LevelIntegrator</code> (satisfies <code>HyperbolicSystemLevelIntegrator</code>)</p> </li><li data-md><p><code>KineticSourceTerm</code> (satisfies <code>LevelIntegrator</code>)</p> </li><li data-md><p><code>AxialSourceTerm</code> (satisfies <code>LevelIntegrator</code>)</p> </li><li data-md><p><code>IgniteDetonation</code> (satisfies <code>LevelIntegrator</code>)</p> </li></ul> <p><code>SystemSourceLevelIntegrator</code> and <code>BK19LevelIntegrator</code> are so-called composed level integrators.
This means, in order to build one of those level integrators you need to provide at least one <code>HyperbolicSystemLevelIntegrator</code>.
The only <code>HyperbolicSystemLevelIntegrator</code> currently defined in the library is the <code>DimensionalSplitLevelIntegrator</code> which applies dimensional operator splitting ontop of a <code>DimensionalSplitIntegratorContext</code>.</p> <p>A <code>DimensionalSplitLevelIntegrator</code> is constructible by providing a <code>DimensionalSplitIntegratorContext</code> and <code>SplittingMethod</code>, such as <code>GodunovSplitting</code> or <code>StrangSplitting</code>.
A single dimensionally split time step includes the following steps</p> <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line">  <c- c1>// Apply boundary condition for the physical boundary only.</c-></span><span class="line-no" data-line="2"></span><span class="line">  <c- n>Context</c-><c- o>::</c-><c- n>ApplyBoundaryCondition</c-><c- p>(</c-><c- n>this_level</c-><c- p>,</c-> <c- n>dir</c-><c- p>);</c-></span><span class="line-no" data-line="3"></span><span class="line"></span><span class="line-no" data-line="4"></span><span class="line">  <c- c1>// Check stable time step size and if the CFL condition is violated then</c-></span><span class="line-no" data-line="5"></span><span class="line">  <c- c1>// restart the coarse time step</c-></span><span class="line-no" data-line="6"></span><span class="line">  <c- k>const</c-> <c- n>Duration</c-> <c- n>local_dt</c-> <c- o>=</c-> <c- n>Context</c-><c- o>::</c-><c- n>ComputeStableDt</c-><c- p>(</c-><c- n>this_level</c-><c- p>,</c-> <c- n>dir</c-><c- p>);</c-></span><span class="line-no" data-line="7"></span><span class="line">  <c- n>MPI_Comm</c-> <c- n>comm</c-> <c- o>=</c-> <c- n>GetMpiCommunicator</c-><c- p>();</c-></span><span class="line-no" data-line="8"></span><span class="line">  <c- k>const</c-> <c- n>Duration</c-> <c- n>level_dt</c-> <c- o>=</c-> <c- n>MinAll</c-><c- p>(</c-><c- n>comm</c-><c- p>,</c-> <c- n>local_dt</c-><c- p>);</c-></span><span class="line-no" data-line="9"></span><span class="line">  <c- k>if</c-> <c- p>(</c-><c- n>level_dt</c-> <c- o>&lt;</c-> <c- n>split_dt</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="10"></span><span class="line">    <c- k>return</c-> <c- n>TimeStepTooLarge</c-><c- p>{</c-><c- n>level_dt</c-><c- p>,</c-> <c- n>this_level</c-><c- p>};</c-></span><span class="line-no" data-line="11"></span><span class="line">  <c- p>}</c-></span><span class="line-no" data-line="12"></span><span class="line"></span><span class="line-no" data-line="13"></span><span class="line">  <c- c1>// Compute fluxes in the specified direction</c-></span><span class="line-no" data-line="14"></span><span class="line">  <c- n>Context</c-><c- o>::</c-><c- n>ComputeNumericFluxes</c-><c- p>(</c-><c- n>this_level</c-><c- p>,</c-> <c- n>split_dt</c-><c- p>,</c-> <c- n>dir</c-><c- p>);</c-></span><span class="line-no" data-line="15"></span><span class="line"></span><span class="line-no" data-line="16"></span><span class="line">  <c- c1>// Use the updated fluxes to update cons variables at the "SCRATCH"</c-></span><span class="line-no" data-line="17"></span><span class="line">  <c- c1>// context.</c-></span><span class="line-no" data-line="18"></span><span class="line">  <c- n>Context</c-><c- o>::</c-><c- n>UpdateConservatively</c-><c- p>(</c-><c- n>this_level</c-><c- p>,</c-> <c- n>split_dt</c-><c- p>,</c-> <c- n>dir</c-><c- p>);</c-></span><span class="line-no" data-line="19"></span><span class="line"></span><span class="line-no" data-line="20"></span><span class="line">  <c- c1>// A time update happened on conservative variables.</c-></span><span class="line-no" data-line="21"></span><span class="line">  <c- c1>// We have to re-establish a valid complete state.</c-></span><span class="line-no" data-line="22"></span><span class="line">  <c- n>Context</c-><c- o>::</c-><c- n>CompleteFromCons</c-><c- p>(</c-><c- n>this_level</c-><c- p>,</c-> <c- n>split_dt</c-><c- p>);</c-></span><span class="line-no" data-line="23"></span><span class="line"></span><span class="line-no" data-line="24"></span><span class="line">  <c- c1>// Accumulate the fluxes on the coarse fine interface</c-></span><span class="line-no" data-line="25"></span><span class="line">  <c- k>const</c-> <c- b>double</c-> <c- n>scale</c-> <c- o>=</c-> <c- n>split_dt</c-><c- p>.</c-><c- n>count</c-><c- p>();</c-></span><span class="line-no" data-line="26"></span><span class="line">  <c- n>Context</c-><c- o>::</c-><c- n>AccumulateCoarseFineFluxes</c-><c- p>(</c-><c- n>this_level</c-><c- p>,</c-> <c- n>scale</c-><c- p>,</c-> <c- n>dir</c-><c- p>);</c-></span></pre> <h3 class="heading settled" data-level="2.7" id="subcycle-solver"><span class="secno">2.7. </span><span class="content">Algorithmic Choice: SubcycleSovler</span><a class="self-link" href="#subcycle-solver"></a></h3> <p>Finally, subcycle solvers define in which order level integrators are applied on the refinement level of a hierarchy.
They define the functions <code>ComputeStableDt</code> and <code>AdvanceLevel</code>.</p> <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- k>template</c-> <c- o>&lt;</c-><c- k>typename</c-> <c- n>S</c-><c- o>></c-></span><span class="line-no" data-line="2"></span><span class="line"><c- k>concept</c-> <c- n>SubcycleSolver</c-> <c- o>=</c-> <c- n>std</c-><c- o>::</c-><c- n>copy_assignable</c-><c- o>&lt;</c-><c- n>S</c-><c- o>></c-> <c- o>&amp;&amp;</c-> <c- k>requires</c-> <c- p>(</c-><c- k>const</c-> <c- n>S</c-><c- o>&amp;</c-> <c- n>solver</c-><c- p>,</c-> <c- b>int</c-> <c- n>level</c-><c- p>,</c-> <c- n>Duration</c-> <c- n>dt</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="3"></span><span class="line">  <c- p>{</c-> <c- n>solver</c-><c- p>.</c-><c- n>ComputeStableDt</c-><c- p>()</c-> <c- p>}</c-> <c- o>-></c-> <c- n>Duration</c-><c- p>;</c-></span><span class="line-no" data-line="4"></span><span class="line">  <c- p>{</c-> <c- n>solver</c-><c- p>.</c-><c- n>AdvanceLevel</c-><c- p>(</c-><c- n>level</c-><c- p>,</c-> <c- n>dt</c-><c- p>)</c-> <c- p>}</c-> <c- o>-></c-> <c- n>Result</c-><c- o>&lt;</c-><c- b>void</c-><c- p>,</c-> <c- n>TimeStepTooLarge</c-><c- o>></c-><c- p>;</c-></span><span class="line-no" data-line="5"></span><span class="line"><c- p>};</c-></span></pre> <p>The <code>AdvanceLevel</code> function advances all levels finer or equal than the specified level.
Most implementations define this function recursively.</p> <div class="example" id="example-4c8e4151"><a class="self-link" href="#example-4c8e4151"></a> An examplary implementation of an recursive AdvanceLevel function is given here. <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- k>template</c-> <c- o>&lt;</c-><c- k>typename</c-> <c- n>LevelIntegrator</c-><c- o>></c-></span><span class="line-no" data-line="2"></span><span class="line"><c- n>Result</c-><c- o>&lt;</c-><c- b>void</c-><c- p>,</c-> <c- n>TimeStepTooLarge</c-><c- o>></c-></span><span class="line-no" data-line="3"></span><span class="line"><c- n>SubcycleFineFirstSolver</c-><c- o>&lt;</c-><c- n>LevelIntegrator</c-><c- o>>::</c-><c- n>AdvanceLevel</c-><c- p>(</c-></span><span class="line-no" data-line="4"></span><span class="line">    <c- b>int</c-> <c- n>this_level</c-><c- p>,</c-> <c- n>Duration</c-> <c- n>dt</c-><c- p>,</c-> <c- n>std</c-><c- o>::</c-><c- n>pair</c-><c- o>&lt;</c-><c- b>int</c-><c- p>,</c-> <c- b>int</c-><c- o>></c-> <c- n>subcycle</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="5"></span><span class="line">  <c- c1>// PreAdvanceLevel might regrid all finer levels.</c-></span><span class="line-no" data-line="6"></span><span class="line">  <c- c1>// The context must make sure that scratch data is allocated</c-></span><span class="line-no" data-line="7"></span><span class="line">  <c- n>PreAdvanceLevel</c-><c- p>(</c-><c- n>this_level</c-><c- p>,</c-> <c- n>dt</c-><c- p>,</c-> <c- n>subcycle</c-><c- p>);</c-></span><span class="line-no" data-line="8"></span><span class="line"></span><span class="line-no" data-line="9"></span><span class="line">  <c- k>auto</c-> <c- n>scale_dt_on_error</c-> <c- o>=</c-> <c- p>[</c-><c- k>this</c-><c- p>](</c-><c- n>Result</c-><c- o>&lt;</c-><c- b>void</c-><c- p>,</c-> <c- n>TimeStepTooLarge</c-><c- o>></c-> <c- n>result</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="10"></span><span class="line">    <c- n>TimeStepTooLarge</c-> <c- n>error</c-> <c- o>=</c-> <c- n>result</c-><c- p>.</c-><c- n>error</c-><c- p>();</c-></span><span class="line-no" data-line="11"></span><span class="line">    <c- b>int</c-> <c- n>ratio</c-> <c- o>=</c-> <c- n>GetTotalRefineRatio</c-><c- p>(</c-><c- n>error</c-><c- p>.</c-><c- n>level</c-><c- p>);</c-></span><span class="line-no" data-line="12"></span><span class="line">    <c- n>error</c-><c- p>.</c-><c- n>level</c-> <c- o>=</c-> <c- mi>0</c-><c- p>;</c-></span><span class="line-no" data-line="13"></span><span class="line">    <c- n>error</c-><c- p>.</c-><c- n>dt</c-> <c- o>*=</c-> <c- n>ratio</c-><c- p>;</c-></span><span class="line-no" data-line="14"></span><span class="line">    <c- k>return</c-> <c- n>error</c-><c- p>;</c-></span><span class="line-no" data-line="15"></span><span class="line">  <c- p>};</c-></span><span class="line-no" data-line="16"></span><span class="line"></span><span class="line-no" data-line="17"></span><span class="line">  <c- c1>// If a finer level exists in the hierarchy, we subcycle that finer level</c-></span><span class="line-no" data-line="18"></span><span class="line">  <c- c1>// multiple times and use the fine fluxes on coarse-fine interfaces</c-></span><span class="line-no" data-line="19"></span><span class="line">  <c- k>const</c-> <c- b>int</c-> <c- n>next_level</c-> <c- o>=</c-> <c- n>this_level</c-> <c- o>+</c-> <c- mi>1</c-><c- p>;</c-></span><span class="line-no" data-line="20"></span><span class="line">  <c- k>if</c-> <c- p>(</c-><c- n>LevelExists</c-><c- p>(</c-><c- n>next_level</c-><c- p>))</c-> <c- p>{</c-></span><span class="line-no" data-line="21"></span><span class="line">    <c- n>ResetCoarseFineFluxes</c-><c- p>(</c-><c- n>next_level</c-><c- p>,</c-> <c- n>this_level</c-><c- p>);</c-></span><span class="line-no" data-line="22"></span><span class="line">    <c- k>const</c-> <c- b>int</c-> <c- n>refine_ratio</c-> <c- o>=</c-> <c- n>GetRatioToCoarserLevel</c-><c- p>(</c-><c- n>next_level</c-><c- p>).</c-><c- n>max</c-><c- p>();</c-></span><span class="line-no" data-line="23"></span><span class="line">    <c- k>for</c-> <c- p>(</c-><c- b>int</c-> <c- n>r</c-> <c- o>=</c-> <c- mi>0</c-><c- p>;</c-> <c- n>r</c-> <c- o>&lt;</c-> <c- n>refine_ratio</c-><c- p>;</c-> <c- o>++</c-><c- n>r</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="24"></span><span class="line">      <c- k>auto</c-> <c- n>result</c-> <c- o>=</c-></span><span class="line-no" data-line="25"></span><span class="line">          <c- n>AdvanceLevel</c-><c- p>(</c-><c- n>next_level</c-><c- p>,</c-> <c- n>dt</c-> <c- o>/</c-> <c- n>refine_ratio</c-><c- p>,</c-> <c- p>{</c-><c- n>r</c-><c- p>,</c-> <c- n>refine_ratio</c-><c- p>});</c-></span><span class="line-no" data-line="26"></span><span class="line">      <c- k>if</c-> <c- p>(</c-><c- o>!</c-><c- n>result</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="27"></span><span class="line">        <c- k>return</c-> <c- n>scale_dt_on_error</c-><c- p>(</c-><c- n>result</c-><c- p>);</c-></span><span class="line-no" data-line="28"></span><span class="line">      <c- p>}</c-></span><span class="line-no" data-line="29"></span><span class="line">    <c- p>}</c-></span><span class="line-no" data-line="30"></span><span class="line">  <c- p>}</c-></span><span class="line-no" data-line="31"></span><span class="line"></span><span class="line-no" data-line="32"></span><span class="line">  <c- n>Result</c-><c- o>&lt;</c-><c- b>void</c-><c- p>,</c-> <c- n>TimeStepTooLarge</c-><c- o>></c-> <c- n>result</c-> <c- o>=</c-></span><span class="line-no" data-line="33"></span><span class="line">      <c- n>AdvanceLevelNonRecursively</c-><c- p>(</c-><c- n>this_level</c-><c- p>,</c-> <c- n>dt</c-><c- p>,</c-> <c- n>subcycle</c-><c- p>);</c-></span><span class="line-no" data-line="34"></span><span class="line">  <c- k>if</c-> <c- p>(</c-><c- o>!</c-><c- n>result</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="35"></span><span class="line">    <c- k>return</c-> <c- n>scale_dt_on_error</c-><c- p>(</c-><c- n>result</c-><c- p>);</c-></span><span class="line-no" data-line="36"></span><span class="line">  <c- p>}</c-></span><span class="line-no" data-line="37"></span><span class="line">  <c- k>if</c-> <c- p>(</c-><c- n>LevelExists</c-><c- p>(</c-><c- n>next_level</c-><c- p>))</c-> <c- p>{</c-></span><span class="line-no" data-line="38"></span><span class="line">    <c- n>ApplyFluxCorrection</c-><c- p>(</c-><c- n>next_level</c-><c- p>,</c-> <c- n>this_level</c-><c- p>,</c-> <c- n>dt</c-><c- p>);</c-></span><span class="line-no" data-line="39"></span><span class="line">  <c- p>}</c-></span><span class="line-no" data-line="40"></span><span class="line"></span><span class="line-no" data-line="41"></span><span class="line">  <c- c1>// Coarsen inner regions from next finer level to this level.</c-></span><span class="line-no" data-line="42"></span><span class="line">  <c- k>if</c-> <c- p>(</c-><c- n>LevelExists</c-><c- p>(</c-><c- n>next_level</c-><c- p>))</c-> <c- p>{</c-></span><span class="line-no" data-line="43"></span><span class="line">    <c- n>CoarsenConservatively</c-><c- p>(</c-><c- n>next_level</c-><c- p>,</c-> <c- n>this_level</c-><c- p>);</c-></span><span class="line-no" data-line="44"></span><span class="line"></span><span class="line-no" data-line="45"></span><span class="line">    <c- c1>// The conservative update and the coarsening happened on conservative</c-></span><span class="line-no" data-line="46"></span><span class="line">    <c- c1>// variables. We have to reconstruct the missing variables in the complete</c-></span><span class="line-no" data-line="47"></span><span class="line">    <c- c1>// state.</c-></span><span class="line-no" data-line="48"></span><span class="line">    <c- n>CompleteFromCons</c-><c- p>(</c-><c- n>this_level</c-><c- p>,</c-> <c- n>dt</c-><c- p>);</c-></span><span class="line-no" data-line="49"></span><span class="line">  <c- p>}</c-></span><span class="line-no" data-line="50"></span><span class="line"></span><span class="line-no" data-line="51"></span><span class="line">  <c- n>CopyScratchToData</c-><c- p>(</c-><c- n>this_level</c-><c- p>);</c-></span><span class="line-no" data-line="52"></span><span class="line"></span><span class="line-no" data-line="53"></span><span class="line">  <c- c1>// Apply any further context related work after advancing this level.</c-></span><span class="line-no" data-line="54"></span><span class="line">  <c- c1>// This function can also indicate if some error occured.</c-></span><span class="line-no" data-line="55"></span><span class="line">  <c- c1>// For example the context could detect unphysical states and return a</c-></span><span class="line-no" data-line="56"></span><span class="line">  <c- c1>// TooLargeTimeStep error condition.</c-></span><span class="line-no" data-line="57"></span><span class="line">  <c- n>result</c-> <c- o>=</c-> <c- n>PostAdvanceLevel</c-><c- p>(</c-><c- n>this_level</c-><c- p>,</c-> <c- n>dt</c-><c- p>,</c-> <c- n>subcycle</c-><c- p>);</c-></span><span class="line-no" data-line="58"></span><span class="line">  <c- k>if</c-> <c- p>(</c-><c- o>!</c-><c- n>result</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="59"></span><span class="line">    <c- k>return</c-> <c- n>scale_dt_on_error</c-><c- p>(</c-><c- n>result</c-><c- p>);</c-></span><span class="line-no" data-line="60"></span><span class="line">  <c- p>}</c-></span><span class="line-no" data-line="61"></span><span class="line">  <c- k>return</c-> <c- n>result</c-><c- p>;</c-></span><span class="line-no" data-line="62"></span><span class="line"><c- p>}</c-></span></pre></div> <p>The present subcycle solvers depend on a level integrator only.
Future solvers may need additional options that may decsribe varying subcycle ratios between pairs of refinement levels.</p> <h2 class="heading settled" data-level="3" id="flux-method-framework"><span class="secno">3. </span><span class="content">Framework for defining FluxMethods</span><a class="self-link" href="#flux-method-framework"></a></h2> <p>The <code>FluxMethod&lt;IntegratorContext></code> policy is very generic and allows all kinds of possible logic in user-defined flux methods.
We provide adapter classes to separate the technical aspects of computing those numerical fluxes from the mathematical ones.
To achieve this separation we begin by introducing the notion of an equation.
An equation gives context to the components of a multi-dimensional array and provides the mathematical dependencies needed.
Using those tools we allow a formulation \( F(q(x, t), dx, dt) \) of flux methods, which depend on a stencil of equation states only.</p> <h3 class="heading settled" data-level="3.1" id="cons-comp-states"><span class="secno">3.1. </span><span class="content">Equation: Conservative and Complete States</span><a class="self-link" href="#cons-comp-states"></a></h3> <p>The Finite Volume Solver defines so-called equation classes, for example, <code>Advection2d</code> or <code>PerfectGas&lt;Rank></code>.
Each equation defines two kinds of states: <code>Conservative</code> and <code>Complete</code> states.
The conservative states contain variables which see a hyperbolic time update of a time integrator.
The complete state variables are a superset of the conservative ones and may define more auxiliary member variables.
This is reasonable for variables which are needed very often but have a high computation cost.
The complete state is the location to cache those expensive computations.</p> <div class="example" id="example-46a4bb05"><a class="self-link" href="#example-46a4bb05"></a> For example, the template class <code>template &lt;int Rank> class PerfectGas</code> defines the conservative variables <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- k>template</c-> <c- o>&lt;</c-><c- b>int</c-> <c- n>Rank</c-><c- o>></c-> <c- k>struct</c-> <c- n>PerfectGasConservative</c-> <c- p>{</c-></span><span class="line-no" data-line="2"></span><span class="line">  <c- b>double</c-> <c- n>density</c-><c- p>;</c-></span><span class="line-no" data-line="3"></span><span class="line">  <c- n>Array</c-><c- o>&lt;</c-><c- b>double</c-><c- p>,</c-> <c- n>Rank</c-><c- o>></c-> <c- n>momentum</c-><c- p>;</c-></span><span class="line-no" data-line="4"></span><span class="line">  <c- b>double</c-> <c- n>energy</c-><c- p>;</c-></span><span class="line-no" data-line="5"></span><span class="line"><c- p>};</c-></span></pre> <p>and the complete state variables are</p> <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- k>template</c-> <c- o>&lt;</c-><c- b>int</c-> <c- n>Rank</c-><c- o>></c-> <c- k>struct</c-> <c- nl>PerfectGasComplete</c-> <c- p>:</c-> <c- n>PerfectGasConservative</c-><c- o>&lt;</c-><c- n>Rank</c-><c- o>></c-> <c- p>{</c-></span><span class="line-no" data-line="2"></span><span class="line">  <c- b>double</c-> <c- n>pressure</c-><c- p>;</c-></span><span class="line-no" data-line="3"></span><span class="line">  <c- b>double</c-> <c- n>speed_of_sound</c-><c- p>;</c-></span><span class="line-no" data-line="4"></span><span class="line"><c- p>};</c-></span></pre></div> <p>Given a <code>MultiFab</code> object we can iterate over all local <code>FArrayBox</code> objects using the <code>MFIter</code> iterator as in this simplified example:</p> <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- k>template</c-> <c- o>&lt;</c-><c- k>typename</c-> <c- n>Function</c-><c- o>></c-></span><span class="line-no" data-line="2"></span><span class="line"><c- b>void</c-> <c- n>DoSomethingForEachFArrayBox</c-><c- p>(</c-><c- n>amrex</c-><c- o>::</c-><c- n>MultiFab</c-><c- o>&amp;</c-> <c- n>multifab</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="3"></span><span class="line">  <c- k>for</c-> <c- p>(</c-><c- n>amrex</c-><c- o>::</c-><c- n>MFIter</c-> <c- n>mfi</c-><c- p>(</c-><c- n>multifab</c-><c- p>);</c-> <c- n>mfi</c-><c- p>.</c-><c- n>isValid</c-><c- p>();</c-> <c- o>++</c-><c- n>mfi</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="4"></span><span class="line">    <c- n>amrex</c-><c- o>::</c-><c- n>FArrayBox</c-><c- o>&amp;</c-> <c- n>fab</c-> <c- o>=</c-> <c- n>multifab</c-><c- p>[</c-><c- n>mfi</c-><c- p>];</c-></span><span class="line-no" data-line="5"></span><span class="line">    <c- c1>// do something...</c-></span><span class="line-no" data-line="6"></span><span class="line">  <c- p>}</c-></span><span class="line-no" data-line="7"></span><span class="line"><c- p>}</c-></span></pre> <p><code>amrex::FArrayBox</code> is a container type in <a data-link-type="biblio" href="#biblio-amrex">[AMReX]</a> that stores a multi-dimensional data array for a single patch.
By using an equation object we can <em>view</em> this <code>amrex::FArrayBox</code> as a set of multi-dimensional arrays for each variable.</p> <div class="example" id="example-f43b712e"><a class="self-link" href="#example-f43b712e"></a> Lets assume for this example that we are in a context where we are given a <code>FArrayBox</code> and we want to access the variables of this patch.
In order to so we need an equation object which interprets the raw data. <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- k>struct</c-> <c- n>MyClass</c-> <c- p>{</c-></span><span class="line-no" data-line="2"></span><span class="line">  <c- k>using</c-> <c- n>Complete</c-> <c- o>=</c-> <c- o>::</c-><c- n>fub</c-><c- o>::</c-><c- n>Complete</c-><c- o>&lt;</c-><c- n>PerfectGas</c-><c- o>&lt;</c-><c- mi>3</c-><c- o>>></c-><c- p>;</c-></span><span class="line-no" data-line="3"></span><span class="line">  <c- k>using</c-> <c- n>Conservative</c-> <c- o>=</c-> <c- o>::</c-><c- n>fub</c-><c- o>::</c-><c- n>Conservative</c-><c- o>&lt;</c-><c- n>PerfectGas</c-><c- o>&lt;</c-><c- mi>3</c-><c- o>>></c-><c- p>;</c-></span><span class="line-no" data-line="4"></span><span class="line"></span><span class="line-no" data-line="5"></span><span class="line">  <c- b>void</c-> <c- nf>foo</c-><c- p>(</c-><c- o>::</c-><c- n>amrex</c-><c- o>::</c-><c- n>FArrayBox</c-><c- o>&amp;</c-> <c- n>raw_data</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="6"></span><span class="line">    <c- c1>// Transform the raw data object to a View object.</c-></span><span class="line-no" data-line="7"></span><span class="line">    <c- k>auto</c-> <c- n>mutable_states</c-> <c- o>=</c-> <c- n>MakeView</c-><c- o>&lt;</c-><c- n>Complete</c-><c- o>></c-><c- p>(</c-><c- n>raw_data</c-><c- p>,</c-> <c- n>equation</c-><c- p>);</c-></span><span class="line-no" data-line="8"></span><span class="line">    <c- k>auto</c-> <c- n>const_states</c-> <c- o>=</c-> <c- n>MakeView</c-><c- o>&lt;</c-><c- k>const</c-> <c- n>Complete</c-><c- o>></c-><c- p>(</c-><c- n>raw_data</c-><c- p>,</c-> <c- n>equation</c-><c- p>);</c-></span><span class="line-no" data-line="9"></span><span class="line">    <c- k>auto</c-> <c- n>conservatives</c-> <c- o>=</c-> <c- n>MakeView</c-><c- o>&lt;</c-><c- n>Conservative</c-><c- o>></c-><c- p>(</c-><c- n>raw_data</c-><c- p>,</c-> <c- n>equation</c-><c- p>);</c-></span><span class="line-no" data-line="10"></span><span class="line">    <c- c1>// Iterate through all global grid indices</c-></span><span class="line-no" data-line="11"></span><span class="line">    <c- n>ForEachIndex</c-><c- p>(</c-><c- n>Box</c-><c- o>&lt;</c-><c- mi>0</c-><c- o>></c-><c- p>(</c-><c- n>const_states</c-><c- p>),</c-> <c- p>[</c-><c- o>=</c-><c- p>](</c-><c- b>int</c-> <c- n>i</c-><c- p>,</c-> <c- b>int</c-> <c- n>j</c-><c- p>,</c-> <c- b>int</c-> <c- n>k</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="12"></span><span class="line">      <c- c1>// Access the variables</c-></span><span class="line-no" data-line="13"></span><span class="line">      <c- n>mutable_states</c-><c- p>.</c-><c- n>density</c-><c- p>(</c-><c- n>i</c-><c- p>,</c-> <c- n>j</c-><c- p>,</c-> <c- n>k</c-><c- p>)</c-> <c- o>=</c-> <c- mf>1.0</c-><c- p>;</c-></span><span class="line-no" data-line="14"></span><span class="line">      <c- n>conservatives</c-><c- p>.</c-><c- n>momentum</c-><c- p>(</c-><c- n>i</c-><c- p>,</c-> <c- n>j</c-><c- p>,</c-> <c- n>k</c-><c- p>,</c-> <c- mi>0</c-><c- p>)</c-> <c- o>=</c-> <c- mf>1.0</c-> <c- o>+</c-> <c- n>const_states</c-><c- p>.</c-><c- n>density</c-><c- p>(</c-><c- n>i</c-><c- p>,</c-> <c- n>j</c-><c- p>,</c-> <c- n>k</c-><c- p>);</c-></span><span class="line-no" data-line="15"></span><span class="line">      <c- n>conservatives</c-><c- p>.</c-><c- n>momentum</c-><c- p>(</c-><c- n>i</c-><c- p>,</c-> <c- n>j</c-><c- p>,</c-> <c- n>k</c-><c- p>,</c-> <c- mi>1</c-><c- p>)</c-> <c- o>=</c-> <c- mf>0.0</c-><c- p>;</c-></span><span class="line-no" data-line="16"></span><span class="line">      <c- n>conservatives</c-><c- p>.</c-><c- n>momentum</c-><c- p>(</c-><c- n>i</c-><c- p>,</c-> <c- n>j</c-><c- p>,</c-> <c- n>k</c-><c- p>,</c-> <c- mi>2</c-><c- p>)</c-> <c- o>=</c-> <c- mf>0.0</c-><c- p>;</c-></span><span class="line-no" data-line="17"></span><span class="line"></span><span class="line-no" data-line="18"></span><span class="line">      <c- c1>// The objects view the same memory.</c-></span><span class="line-no" data-line="19"></span><span class="line">      <c- n>assert</c-><c- p>(</c-><c- n>const_states</c-><c- p>.</c-><c- n>momentum</c-><c- p>(</c-><c- n>i</c-><c- p>,</c-> <c- n>j</c-><c- p>,</c-> <c- n>k</c-><c- p>,</c-> <c- mi>0</c-><c- p>)</c-> <c- o>==</c-> <c- n>conservatives</c-><c- p>.</c-><c- n>momentum</c-><c- p>(</c-><c- n>i</c-><c- p>,</c-> <c- n>j</c-><c- p>,</c-> <c- n>k</c-><c- p>,</c-> <c- mi>0</c-><c- p>));</c-></span><span class="line-no" data-line="20"></span><span class="line">      <c- n>assert</c-><c- p>(</c-><c- n>const_states</c-><c- p>.</c-><c- n>momentum</c-><c- p>(</c-><c- n>i</c-><c- p>,</c-> <c- n>j</c-><c- p>,</c-> <c- n>k</c-><c- p>,</c-> <c- mi>1</c-><c- p>)</c-> <c- o>==</c-> <c- n>conservatives</c-><c- p>.</c-><c- n>momentum</c-><c- p>(</c-><c- n>i</c-><c- p>,</c-> <c- n>j</c-><c- p>,</c-> <c- n>k</c-><c- p>,</c-> <c- mi>1</c-><c- p>));</c-></span><span class="line-no" data-line="21"></span><span class="line">      <c- n>assert</c-><c- p>(</c-><c- n>const_states</c-><c- p>.</c-><c- n>momentum</c-><c- p>(</c-><c- n>i</c-><c- p>,</c-> <c- n>j</c-><c- p>,</c-> <c- n>k</c-><c- p>,</c-> <c- mi>2</c-><c- p>)</c-> <c- o>==</c-> <c- n>conservatives</c-><c- p>.</c-><c- n>momentum</c-><c- p>(</c-><c- n>i</c-><c- p>,</c-> <c- n>j</c-><c- p>,</c-> <c- n>k</c-><c- p>,</c-> <c- mi>2</c-><c- p>));</c-></span><span class="line-no" data-line="22"></span><span class="line">    <c- p>});</c-></span><span class="line-no" data-line="23"></span><span class="line">  <c- p>}</c-></span><span class="line-no" data-line="24"></span><span class="line"></span><span class="line-no" data-line="25"></span><span class="line">  <c- n>PerfectGas</c-><c- o>&lt;</c-><c- mi>3</c-><c- o>></c-> <c- n>equation</c-><c- p>;</c-></span><span class="line-no" data-line="26"></span><span class="line"><c- p>};</c-></span></pre></div> <p>Once we have a <code>View</code> object that gives variable-wise access of multi-dimensional data we can load and store state objects, such as <code>Complete&lt;Equation></code> and <code>Conservative&lt;Equation></code>, from and to memory locations inidicated by global space indices <code>(i, j, k)</code>.</p> <div class="example" id="example-f288bb39"><a class="self-link" href="#example-f288bb39"></a> We can lift a function that is a defined for state equations, such as <code>Complete&lt;Equation></code>, to a function which is defined on a multi-dimensional array <code>View&lt;Complete&lt;Equation>></code> by applying its logic for each index. <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- k>struct</c-> <c- n>MyClass</c-> <c- p>{</c-></span><span class="line-no" data-line="2"></span><span class="line">  <c- k>using</c-> <c- n>Complete</c-> <c- o>=</c-> <c- o>::</c-><c- n>fub</c-><c- o>::</c-><c- n>Complete</c-><c- o>&lt;</c-><c- n>PerfectGas</c-><c- o>&lt;</c-><c- mi>3</c-><c- o>>></c-><c- p>;</c-></span><span class="line-no" data-line="3"></span><span class="line">  <c- k>using</c-> <c- n>Conservative</c-> <c- o>=</c-> <c- o>::</c-><c- n>fub</c-><c- o>::</c-><c- n>Conservative</c-><c- o>&lt;</c-><c- n>PerfectGas</c-><c- o>&lt;</c-><c- mi>3</c-><c- o>>></c-><c- p>;</c-></span><span class="line-no" data-line="4"></span><span class="line"></span><span class="line-no" data-line="5"></span><span class="line">  <c- b>void</c-> <c- nf>Foo</c-><c- p>(</c-><c- n>Complete</c-><c- o>&amp;</c-> <c- n>state</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="6"></span><span class="line">    <c- n>state</c-><c- p>.</c-><c- n>density</c-> <c- o>=</c-> <c- mf>1.0</c-><c- p>;</c-></span><span class="line-no" data-line="7"></span><span class="line">    <c- n>state</c-><c- p>.</c-><c- n>momentum</c-><c- p>[</c-><c- mi>0</c-><c- p>]</c-> <c- o>=</c-> <c- mf>1.0</c-> <c- o>+</c-> <c- n>state</c-><c- p>.</c-><c- n>pressure</c-><c- p>;</c-></span><span class="line-no" data-line="8"></span><span class="line">    <c- n>state</c-><c- p>.</c-><c- n>momentum</c-><c- p>[</c-><c- mi>1</c-><c- p>]</c-> <c- o>=</c-> <c- mf>0.0</c-><c- p>;</c-></span><span class="line-no" data-line="9"></span><span class="line">    <c- n>state</c-><c- p>.</c-><c- n>momentum</c-><c- p>[</c-><c- mi>2</c-><c- p>]</c-> <c- o>=</c-> <c- mf>0.0</c-><c- p>;</c-></span><span class="line-no" data-line="10"></span><span class="line">  <c- p>}</c-></span><span class="line-no" data-line="11"></span><span class="line"></span><span class="line-no" data-line="12"></span><span class="line">  <c- b>void</c-> <c- nf>LiftedFoo</c-><c- p>(</c-><c- k>const</c-> <c- n>View</c-><c- o>&lt;</c-><c- n>Complete</c-><c- o>>&amp;</c-> <c- n>view</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="13"></span><span class="line">    <c- n>ForEachIndex</c-><c- p>(</c-><c- n>Box</c-><c- o>&lt;</c-><c- mi>0</c-><c- o>></c-><c- p>(</c-><c- n>view</c-><c- p>),</c-> <c- p>[</c-><c- o>=</c-><c- p>](</c-><c- b>int</c-> <c- n>i</c-><c- p>,</c-> <c- b>int</c-> <c- n>j</c-><c- p>,</c-> <c- b>int</c-> <c- n>k</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="14"></span><span class="line">      <c- n>Load</c-><c- p>(</c-><c- n>state</c-><c- p>,</c-> <c- n>view</c-><c- p>,</c-> <c- p>{</c-><c- n>i</c-><c- p>,</c-> <c- n>j</c-><c- p>,</c-> <c- n>k</c-><c- p>});</c-></span><span class="line-no" data-line="15"></span><span class="line">      <c- n>Foo</c-><c- p>(</c-><c- n>state</c-><c- p>);</c-></span><span class="line-no" data-line="16"></span><span class="line">      <c- n>Store</c-><c- p>(</c-><c- n>view</c-><c- p>,</c-> <c- n>state</c-><c- p>,</c-> <c- p>{</c-><c- n>i</c-><c- p>,</c-> <c- n>j</c-><c- p>,</c-> <c- n>k</c-><c- p>});</c-></span><span class="line-no" data-line="17"></span><span class="line">    <c- p>});</c-></span><span class="line-no" data-line="18"></span><span class="line">  <c- p>}</c-></span><span class="line-no" data-line="19"></span><span class="line"></span><span class="line-no" data-line="20"></span><span class="line">  <c- n>PerfectGas</c-><c- o>&lt;</c-><c- mi>3</c-><c- o>></c-> <c- n>equation</c-><c- p>;</c-></span><span class="line-no" data-line="21"></span><span class="line">  <c- n>Complete</c-> <c- nf>state</c-><c- p>(</c-><c- n>equation</c-><c- p>);</c-></span><span class="line-no" data-line="22"></span><span class="line"><c- p>};</c-></span></pre> <p>The member function <code>LiftedFoo</code> in this example can have multiple equivalent implementations that differ in their efficiency.
Its real implementation is often considered an implementation detail and might change.</p> </div> <h3 class="heading settled" data-level="3.2" id="implement-flux-method-simple"><span class="secno">3.2. </span><span class="content">Implement a new FluxMethod, the simple case</span><a class="self-link" href="#implement-flux-method-simple"></a></h3> <p>A class <code>FM</code> satisfies the concept <code>FluxMethod&lt;Equation, StencilSize></code> if the following constraints are satisfied.</p> <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- k>template</c-> <c- o>&lt;</c-><c- k>typename</c-> <c- n>FM</c-><c- p>,</c-> <c- k>typename</c-> <c- n>Equation</c-><c- p>,</c-> <c- b>int</c-> <c- n>StencilSize</c-><c- o>></c-></span><span class="line-no" data-line="2"></span><span class="line"><c- k>concept</c-> <c- n>FluxMethod</c-> <c- o>=</c-> <c- k>requires</c-> <c- p>(</c-><c- n>FM</c-><c- o>&amp;</c-> <c- n>flux_method</c-><c- p>,</c-></span><span class="line-no" data-line="3"></span><span class="line">                               <c- n>Conservative</c-><c- o>&lt;</c-><c- n>Equation</c-><c- o>>&amp;</c-> <c- n>numeric_flux</c-><c- p>,</c-></span><span class="line-no" data-line="4"></span><span class="line">                               <c- n>span</c-><c- o>&lt;</c-><c- k>const</c-> <c- n>Complete</c-><c- o>&lt;</c-><c- n>Equation</c-><c- o>></c-><c- p>,</c-> <c- n>StencilSize</c-><c- o>></c-> <c- n>stencil</c-><c- p>,</c-></span><span class="line-no" data-line="5"></span><span class="line">                               <c- b>double</c-> <c- n>dx</c-><c- p>,</c-> <c- n>Duration</c-> <c- n>dt</c-><c- p>,</c-> <c- n>Direction</c-> <c- n>dir</c-><c- p>)</c-> <c- p>{</c-></span><span class="line-no" data-line="6"></span><span class="line">  <c- p>{</c-> <c- n>flux_method</c-><c- p>.</c-><c- n>ComputeNumericFlux</c-><c- p>(</c-><c- n>numeric_flux</c-><c- p>,</c-> <c- n>stencil</c-><c- p>,</c-> <c- n>dx</c-><c- p>,</c-> <c- n>dt</c-><c- p>,</c-> <c- n>dir</c-><c- p>)</c-> <c- p>};</c-></span><span class="line-no" data-line="7"></span><span class="line">  <c- p>{</c-> <c- n>flux_method</c-><c- p>.</c-><c- n>ComputeStableDt</c-><c- p>(</c-><c- n>stencil</c-><c- p>,</c-> <c- n>dx</c-><c- p>,</c-> <c- n>dir</c-><c- p>)</c-> <c- p>}</c-> <c- o>-></c-> <c- n>Duration</c-><c- p>;</c-></span><span class="line-no" data-line="8"></span><span class="line">  <c- p>{</c-> <c- n>FM</c-><c- o>::</c-><c- n>GetStencilSize</c-><c- p>()</c-> <c- p>}</c-> <c- o>-></c-> <c- n>std</c-><c- o>::</c-><c- n>integral_constant</c-><c- o>&lt;</c-><c- b>int</c-><c- p>,</c-> <c- n>StencilSize</c-><c- o>></c-><c- p>;</c-></span><span class="line-no" data-line="9"></span><span class="line"><c- p>};</c-></span></pre> <div class="example" id="example-1e81720a"><a class="self-link" href="#example-1e81720a"></a> For example, the following declaration of the class <code>MusclHancockMethod</code> satisfies this concept. <pre class="language-cpp highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- k>struct</c-> <c- n>MusclHancockMethod</c-> <c- p>{</c-></span><span class="line-no" data-line="2"></span><span class="line">    <c- k>using</c-> <c- n>Conservative</c-> <c- o>=</c-> <c- o>::</c-><c- n>Conservative</c-><c- o>&lt;</c-><c- n>PerfectGas</c-><c- o>&lt;</c-><c- mi>2</c-><c- o>>></c-><c- p>;</c-></span><span class="line-no" data-line="3"></span><span class="line">    <c- k>using</c-> <c- n>Complete</c-> <c- o>=</c-> <c- o>::</c-><c- n>Complete</c-><c- o>&lt;</c-><c- n>PerfectGas</c-><c- o>&lt;</c-><c- mi>2</c-><c- o>>></c-><c- p>;</c-></span><span class="line-no" data-line="4"></span><span class="line"></span><span class="line-no" data-line="5"></span><span class="line">    <c- b>void</c-> <c- nf>ComputeNumericFlux</c-><c- p>(</c-><c- n>Conservative</c-><c- o>&amp;</c-> <c- n>cons</c-><c- p>,</c-> <c- n>span</c-><c- o>&lt;</c-><c- k>const</c-> <c- n>Complete</c-><c- p>,</c-> <c- mi>4</c-><c- o>></c-> <c- n>stencil</c-><c- p>,</c-></span><span class="line-no" data-line="6"></span><span class="line">                              <c- b>double</c-> <c- n>dx</c-><c- p>,</c-> <c- n>Duration</c-> <c- n>dt</c-><c- p>,</c-> <c- n>Direction</c-> <c- n>dir</c-><c- p>);</c-></span><span class="line-no" data-line="7"></span><span class="line"></span><span class="line-no" data-line="8"></span><span class="line">    <c- n>Duration</c-> <c- nf>ComputeStableDt</c-><c- p>(</c-><c- n>span</c-><c- o>&lt;</c-><c- k>const</c-> <c- n>Complete</c-><c- p>,</c-> <c- mi>4</c-><c- o>></c-> <c- n>stencil</c-><c- p>,</c-> <c- b>double</c-> <c- n>dx</c-><c- p>,</c-> <c- b>int</c-> <c- n>dir</c-><c- p>);</c-></span><span class="line-no" data-line="9"></span><span class="line"></span><span class="line-no" data-line="10"></span><span class="line">    <c- n>std</c-><c- o>::</c-><c- n>integral_constant</c-><c- o>&lt;</c-><c- b>int</c-><c- p>,</c-> <c- mi>2</c-><c- o>></c-> <c- n>GetStencilSize</c-><c- p>()</c-> <c- k>const</c-> <c- k>noexcept</c-> <c- p>{</c-> <c- k>return</c-> <c- p>{};</c-> <c- p>}</c-></span><span class="line-no" data-line="11"></span><span class="line"><c- p>};</c-></span></pre> <p>The implemented MUSCL-type flux methods for an equation <code>Equation</code> satisfy <code>FluxMethod&lt;Equation, 4></code> and are implemented in two steps.
First, we reconstruct a state to the left and the right of the face in question.
This gives a reduction of the stencil array from <code>Complete state[4]</code> to <code>Complete reconstruced_states[2]</code>.
Secondly, we call a (lower-order) base method <code>BaseFM</code> which satisfies <code>FluxMethod&lt;Equation, 2></code>.</p> </div> <h2 class="heading settled" data-level="4" id="using-docker-to-share-and-persist-a-simulation"><span class="secno">4. </span><span class="content">Using Docker to share and persist a simulation</span><a class="self-link" href="#using-docker-to-share-and-persist-a-simulation"></a></h2> <h3 class="heading settled" data-level="4.1" id="how-to-run-an-existing-simulation"><span class="secno">4.1. </span><span class="content">How to run an existing simulation</span><a class="self-link" href="#how-to-run-an-existing-simulation"></a></h3> <p>We describe in the following how to use docker to run the Divider2D application.</p> <ol><li data-md><p>Install docker via https://www.docker.com/</p> </li><li data-md><p>Download the docker image that contains the Divider2D example via</p> <pre class="line-numbered"><span class="line-no" data-line="1"></span><span class="line">$ docker pull maikelnadolski/divider2d</span></pre> </li><li data-md><p>Run the <code>fish</code> command as the <code>amrex</code> user and mount your <code>$HOME</code> directory on the host <code>/home/amrex/volume</code> within the container</p> <pre class="line-numbered"><span class="line-no" data-line="1"></span><span class="line">$ docker run -it -v $HOME:/home/amrex/volume --user amrex -w /home/amrex maikelnadolski/divider2d fish</span><span class="line-no" data-line="2"></span><span class="line">Welcome to fish, the friendly interactive shell</span><span class="line-no" data-line="3"></span><span class="line">Type &lt;code data-opaque bs-autolink-syntax='`help`'>help&lt;/code> for instructions on how to use fish</span><span class="line-no" data-line="4"></span><span class="line">⋊> ~ ls -l                                                                                                                                                                                                 07:09:35</span><span class="line-no" data-line="5"></span><span class="line">total 9132</span><span class="line-no" data-line="6"></span><span class="line">-rwxr-xr-x  1 amrex  amrex  9120504 Jan  8 21:22 AMReX.EB.Divider2D*</span><span class="line-no" data-line="7"></span><span class="line">-rw-r--r--  1 amrex  amrex     3408 Jan  8 21:29 Divider2D.py</span><span class="line-no" data-line="8"></span><span class="line">-rw-r--r--  1 amrex  amrex     2969 Jan  8 21:51 VisualizeHdf5.py</span><span class="line-no" data-line="9"></span><span class="line">-rw-r--r--  1 amrex  amrex     1433 Jan  8 21:33 VisualizePlotfiles.py</span><span class="line-no" data-line="10"></span><span class="line">drwxr-xr-x  1 amrex  amrex     4096 Jan  8 20:18 amrex/</span><span class="line-no" data-line="11"></span><span class="line">drwxr-xr-x 64 maikel maikel   45056 Jan 11 06:26 volume/</span><span class="line-no" data-line="12"></span><span class="line">-rw-r--r--  1 amrex  amrex    27081 Jan  8 18:33 wall_1.txt</span><span class="line-no" data-line="13"></span><span class="line">-rw-r--r--  1 amrex  amrex    54000 Jan  8 18:33 wall_2.txt</span><span class="line-no" data-line="14"></span><span class="line">-rw-r--r--  1 amrex  amrex    81078 Jan  8 18:33 wall_3.txt</span><span class="line-no" data-line="15"></span><span class="line">⋊> ~                                                          </span></pre> </li><li data-md><p>Test the simulation by running the examples with the provided input file</p> </li></ol> <pre class="line-numbered"><span class="line-no" data-line="1"></span><span class="line">⋊> ~ OMP_NUM_THREADS=1 mpiexec AMReX.EB.Divider2D --config Divider2D.py                                                                                                                                    07:09:39</span><span class="line-no" data-line="2"></span><span class="line">MPI initialized with 4 MPI processes</span><span class="line-no" data-line="3"></span><span class="line">MPI initialized with thread support level 0</span><span class="line-no" data-line="4"></span><span class="line">OMP initialized with 1 OMP threads</span><span class="line-no" data-line="5"></span><span class="line">AMReX (20.07-dirty) initialized</span><span class="line-no" data-line="6"></span><span class="line">2021-Jan-11 07:11:41.057392 -- [info] Equation:</span><span class="line-no" data-line="7"></span><span class="line">2021-Jan-11 07:11:41.057507 -- [info]  - gamma = 1.4</span><span class="line-no" data-line="8"></span><span class="line">2021-Jan-11 07:11:41.058302 -- [info]  - Rspec = 287.058</span><span class="line-no" data-line="9"></span><span class="line">2021-Jan-11 07:11:41.058344 -- [info] GridGeometry:</span><span class="line-no" data-line="10"></span><span class="line">2021-Jan-11 07:11:41.058368 -- [info]  - cell_dimensions = {800, 344}</span><span class="line-no" data-line="11"></span><span class="line">2021-Jan-11 07:11:41.058395 -- [info]  - coordinates:lower = {0, -0.045}</span><span class="line-no" data-line="12"></span><span class="line">2021-Jan-11 07:11:41.058420 -- [info]  - coordinates:upper = {0.23, 0.055}</span><span class="line-no" data-line="13"></span><span class="line">2021-Jan-11 07:11:41.058443 -- [info]  - periodicity = {0, 0}</span><span class="line-no" data-line="14"></span><span class="line">2021-Jan-11 07:11:41.058475 -- [info] PatchHierarchy:</span><span class="line-no" data-line="15"></span><span class="line">2021-Jan-11 07:11:41.058498 -- [info]  - max_number_of_levels = 1</span><span class="line-no" data-line="16"></span><span class="line">2021-Jan-11 07:11:41.058521 -- [info]  - refine_ratio = {2, 2}</span><span class="line-no" data-line="17"></span><span class="line">2021-Jan-11 07:11:41.058544 -- [info]  - blocking_factor = {8, 8}</span><span class="line-no" data-line="18"></span><span class="line">2021-Jan-11 07:11:41.058566 -- [info]  - max_grid_size = {800, 344}</span><span class="line-no" data-line="19"></span><span class="line">2021-Jan-11 07:11:41.058588 -- [info]  - n_err_buf = {0, 0}</span><span class="line-no" data-line="20"></span><span class="line">2021-Jan-11 07:11:41.058610 -- [info]  - grid_efficiency = 0.7</span><span class="line-no" data-line="21"></span><span class="line">2021-Jan-11 07:11:41.058633 -- [info]  - n_proper = 1</span><span class="line-no" data-line="22"></span><span class="line">2021-Jan-11 07:11:41.058653 -- [info]  - ngrow_eb_level_set = 9</span><span class="line-no" data-line="23"></span><span class="line">2021-Jan-11 07:11:41.058674 -- [info]  - cutcell_load_balance_weight = 6</span><span class="line-no" data-line="24"></span><span class="line">2021-Jan-11 07:11:41.058704 -- [info]  - remove_covered_grids = false</span><span class="line-no" data-line="25"></span><span class="line">2021-Jan-11 07:11:41.058726 -- [info] Read Wall Data...</span><span class="line-no" data-line="26"></span><span class="line">2021-Jan-11 07:11:41.065565 -- [info] Compute EB level set data...</span><span class="line-no" data-line="27"></span><span class="line">2021-Jan-11 07:11:50.140497 -- [info] Post-Shock-State:</span><span class="line-no" data-line="28"></span><span class="line">2021-Jan-11 07:11:50.140497 -- [info] 	density: 1.22 [kg/m^3]</span><span class="line-no" data-line="29"></span><span class="line">2021-Jan-11 07:11:50.140497 -- [info] 	velocity: 0 0 [m/s]</span><span class="line-no" data-line="30"></span><span class="line">2021-Jan-11 07:11:50.140497 -- [info] 	pressure: 101325 [Pa]</span><span class="line-no" data-line="31"></span><span class="line">2021-Jan-11 07:11:50.140804 -- [info] Calculated Pre-Shock-State:</span><span class="line-no" data-line="32"></span><span class="line">2021-Jan-11 07:11:50.140804 -- [info] 	density: 1.42628 [kg/m^3]</span><span class="line-no" data-line="33"></span><span class="line">2021-Jan-11 07:11:50.140804 -- [info] 	velocity: 54.2485       0 [m/s]</span><span class="line-no" data-line="34"></span><span class="line">2021-Jan-11 07:11:50.140804 -- [info] 	pressure: 126150 [Pa]</span><span class="line-no" data-line="35"></span><span class="line">2021-Jan-11 07:11:50.172436 -- [info] Reconstruction: Characteristics</span><span class="line-no" data-line="36"></span><span class="line">2021-Jan-11 07:11:50.172533 -- [info] scratch_gcw = 2</span><span class="line-no" data-line="37"></span><span class="line">2021-Jan-11 07:11:50.172568 -- [info] flux_gcw = 0</span><span class="line-no" data-line="38"></span><span class="line">2021-Jan-11 07:11:50.184254 -- [Plotfile] [info] [T =            0s] Write Plotfile output to 'Divider_DE5_800/Plotfiles/plt000000000'.</span><span class="line-no" data-line="39"></span><span class="line">2021-Jan-11 07:11:50.247063 -- [HDF5] [info] [T =            0s] Write Hdf5 output to 'Divider_c24_800.h5'.</span><span class="line-no" data-line="40"></span><span class="line">Table of Counters ---------------------------------------------------------------------------------------------------------------------------------------—&lt;wbr>Counter Name          #Calls        Min [ms]        Max [ms]        Avg [ms]     StdDev [ms]     Percent [%]</span><span class="line-no" data-line="41"></span><span class="line">        cutcell::GriddingAlgorithm::InitializeHierarchy               1              31             587             329             211             3.5</span><span class="line-no" data-line="42"></span><span class="line">    cutcell::GriddingAlgorithm::MakeNewLevelFromScratch               1              31              33              32               1            0.34</span><span class="line-no" data-line="43"></span><span class="line">cutcell::IntegratorContext::ResetHierarchyConfiguration               1               9              12              11               1            0.12</span><span class="line-no" data-line="44"></span><span class="line">                cutcell::GriddingAlgorithm::LoadBalance               1               4               5               5               0           0.056</span><span class="line-no" data-line="45"></span><span class="line">          cutcell::IntegratorContext::CopyDataToScratch               1               1               4               3               1           0.033</span><span class="line-no" data-line="46"></span><span class="line">       cutcell::GriddingAlgorithm::PostProcessBaseGrids               1               0               0               0               0           2e-06</span><span class="line-no" data-line="47"></span><span class="line">===========================================================================================================================================================</span><span class="line-no" data-line="48"></span><span class="line">2021-Jan-11 07:11:50.375671 -- [info] RunOptions:</span><span class="line-no" data-line="49"></span><span class="line">2021-Jan-11 07:11:50.375965 -- [info]  - final_time = 0.001 [s]</span><span class="line-no" data-line="50"></span><span class="line">2021-Jan-11 07:11:50.376228 -- [info]  - max_cycles = -1 [-]</span><span class="line-no" data-line="51"></span><span class="line">2021-Jan-11 07:11:50.376509 -- [info]  - smallest_time_step_size = 1e-12 [s]</span><span class="line-no" data-line="52"></span><span class="line">2021-Jan-11 07:11:50.376932 -- [info]  - cfl = 0.8 [-]</span><span class="line-no" data-line="53"></span><span class="line">2021-Jan-11 07:11:50.377185 -- [info]  - do_backup = 0 [-]</span><span class="line-no" data-line="54"></span><span class="line"></span><span class="line-no" data-line="55"></span><span class="line">...</span></pre> <ol start="5"><li data-md><p>Visualize the HDF5 output by executing VisualizeHdf5.py and the AMReX Plotfiles by VisualizePlotfiles.py</p> <pre class="line-numbered"><span class="line-no" data-line="1"></span><span class="line">⋊> ~ python3  VisualizeHdf5.py                                                                                                                                                                             07:14:09</span><span class="line-no" data-line="2"></span><span class="line">Save figure to /home/amrex/Figures/Hdf5/Figure0000.png.</span><span class="line-no" data-line="3"></span><span class="line">Save figure to /home/amrex/Figures/Hdf5/Figure0001.png.</span><span class="line-no" data-line="4"></span><span class="line">Save figure to /home/amrex/Figures/Hdf5/Figure0002.png.</span><span class="line-no" data-line="5"></span><span class="line">Save figure to /home/amrex/Figures/Hdf5/Figure0003.png.</span><span class="line-no" data-line="6"></span><span class="line"></span><span class="line-no" data-line="7"></span><span class="line">...</span><span class="line-no" data-line="8"></span><span class="line"></span><span class="line-no" data-line="9"></span><span class="line">⋊> ~ python3  VisualizePlotfiles.py                                                                                                                                                                        07:14:18</span><span class="line-no" data-line="10"></span><span class="line">/usr/lib/python3.9/_collections_abc.py:684: MatplotlibDeprecationWarning: The global colormaps dictionary is no longer considered public API.</span><span class="line-no" data-line="11"></span><span class="line">  self[key]</span><span class="line-no" data-line="12"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:29,846 Parameters: current_time              = 0.0</span><span class="line-no" data-line="13"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:29,846 Parameters: domain_dimensions         = [800 344   1]</span><span class="line-no" data-line="14"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:29,846 Parameters: domain_left_edge          = [ 0.    -0.045  0.   ]</span><span class="line-no" data-line="15"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:29,847 Parameters: domain_right_edge         = [0.23  0.055 1.   ]</span><span class="line-no" data-line="16"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:29,994 xlim = 0.000000 0.230000</span><span class="line-no" data-line="17"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:29,994 ylim = -0.045000 0.055000</span><span class="line-no" data-line="18"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:29,995 xlim = 0.000000 0.230000</span><span class="line-no" data-line="19"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:29,995 ylim = -0.045000 0.055000</span><span class="line-no" data-line="20"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:29,995 Making a fixed resolution buffer of (('boxlib', 'Density')) 800 by 800</span><span class="line-no" data-line="21"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:30,083 Making a fixed resolution buffer of (('boxlib', 'Pressure')) 800 by 800</span><span class="line-no" data-line="22"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:30,102 Making a fixed resolution buffer of (('boxlib', 'vfrac')) 800 by 800</span><span class="line-no" data-line="23"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:30,676 Making a fixed resolution buffer of (('boxlib', 'Density')) 800 by 344</span><span class="line-no" data-line="24"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:30,691 Making a fixed resolution buffer of (('boxlib', 'Pressure')) 800 by 344</span><span class="line-no" data-line="25"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:30,706 Making a fixed resolution buffer of (('boxlib', 'vfrac')) 800 by 344</span><span class="line-no" data-line="26"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:30,720 Making a fixed resolution buffer of (Pressure) 800 by 344</span><span class="line-no" data-line="27"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:30,736 Making a fixed resolution buffer of (Density) 800 by 344</span><span class="line-no" data-line="28"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:30,752 Making a fixed resolution buffer of (vfrac) 800 by 344</span><span class="line-no" data-line="29"></span><span class="line">/home/amrex/Divider_DE5_800//Plotfiles/plt000000000: 0.0, [ 0.     0.23  -0.045  0.055]</span><span class="line-no" data-line="30"></span><span class="line">Save figure to /home/amrex/Figures/Plotfiles/Figure0000.png.</span><span class="line-no" data-line="31"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:31,640 Parameters: current_time              = 0.000100000001</span><span class="line-no" data-line="32"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:31,640 Parameters: domain_dimensions         = [800 344   1]</span><span class="line-no" data-line="33"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:31,640 Parameters: domain_left_edge          = [ 0.    -0.045  0.   ]</span><span class="line-no" data-line="34"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:31,641 Parameters: domain_right_edge         = [0.23  0.055 1.   ]</span><span class="line-no" data-line="35"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:31,774 xlim = 0.000000 0.230000</span><span class="line-no" data-line="36"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:31,775 ylim = -0.045000 0.055000</span><span class="line-no" data-line="37"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:31,775 xlim = 0.000000 0.230000</span><span class="line-no" data-line="38"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:31,775 ylim = -0.045000 0.055000</span><span class="line-no" data-line="39"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:31,776 Making a fixed resolution buffer of (('boxlib', 'Density')) 800 by 800</span><span class="line-no" data-line="40"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:31,864 Making a fixed resolution buffer of (('boxlib', 'Pressure')) 800 by 800</span><span class="line-no" data-line="41"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:31,884 Making a fixed resolution buffer of (('boxlib', 'vfrac')) 800 by 800</span><span class="line-no" data-line="42"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:32,325 Making a fixed resolution buffer of (('boxlib', 'Density')) 800 by 344</span><span class="line-no" data-line="43"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:32,340 Making a fixed resolution buffer of (('boxlib', 'Pressure')) 800 by 344</span><span class="line-no" data-line="44"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:32,355 Making a fixed resolution buffer of (('boxlib', 'vfrac')) 800 by 344</span><span class="line-no" data-line="45"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:32,369 Making a fixed resolution buffer of (Pressure) 800 by 344</span><span class="line-no" data-line="46"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:32,384 Making a fixed resolution buffer of (Density) 800 by 344</span><span class="line-no" data-line="47"></span><span class="line">yt : [INFO     ] 2021-01-11 07:14:32,402 Making a fixed resolution buffer of (vfrac) 800 by 344</span><span class="line-no" data-line="48"></span><span class="line">/home/amrex/Divider_DE5_800//Plotfiles/plt000000182: 0.000100000001, [ 0.     0.23  -0.045  0.055]</span><span class="line-no" data-line="49"></span><span class="line">Save figure to /home/amrex/Figures/Plotfiles/Figure0001.png.</span><span class="line-no" data-line="50"></span><span class="line"></span><span class="line-no" data-line="51"></span><span class="line">...</span></pre> </li><li data-md><p>Copy the figures to a location of your host computer. You need a directory that is writable for others.
On Unix-like machines you can do on your host side</p> </li></ol> <pre class="line-numbered"><span class="line-no" data-line="1"></span><span class="line">$ mkdir $HOME/docker-output</span><span class="line-no" data-line="2"></span><span class="line">$ chown a+w $HOME/docker-output</span></pre> <p>Then copy from within your docker container</p> <pre class="line-numbered"><span class="line-no" data-line="1"></span><span class="line">⋊> ~ cp -r Figures/ volume/docker-output</span></pre> <ol start="7"><li data-md><p>Adjust the provided input file <code>Divider2D.py</code> by your needs</p> </li></ol> <pre class="line-numbered"><span class="line-no" data-line="1"></span><span class="line">⋊> ~ cp Divider2D.py volume/docker-output</span><span class="line-no" data-line="2"></span><span class="line"></span><span class="line-no" data-line="3"></span><span class="line"># Edit the config file</span><span class="line-no" data-line="4"></span><span class="line"></span><span class="line-no" data-line="5"></span><span class="line">⋊> ~ OMP_NUM_THREADS=1 mpiexec AMReX.EB.Divider2D --config volume/docker-output/Divider2D.py</span></pre> <p>For reference, the provided config file is</p> <pre class="language-python highlight line-numbered"><span class="line-no" data-line="1"></span><span class="line"><c- kn>import</c-> <c- nn>math</c-></span><span class="line-no" data-line="2"></span><span class="line"></span><span class="line-no" data-line="3"></span><span class="line"></span><span class="line-no" data-line="4"></span><span class="line"><c- c1>############################################################################</c-></span><span class="line-no" data-line="5"></span><span class="line"><c- c1># These variables are only auxiliary and are not directly used by the app </c-></span><span class="line-no" data-line="6"></span><span class="line"><c- c1>#</c-></span><span class="line-no" data-line="7"></span><span class="line"></span><span class="line-no" data-line="8"></span><span class="line"><c- k>def</c-> <c- nf>nCellsY</c-><c- p>(</c-><c- n>nCellsX</c-><c- p>,</c-> <c- n>ratio</c-><c- p>,</c-> <c- n>blocking_factor</c-><c- o>=</c-><c- mi>8</c-><c- p>):</c-></span><span class="line-no" data-line="9"></span><span class="line">    <c- n>base</c-> <c- o>=</c-> int<c- p>(</c-><c- n>nCellsX</c-> <c- o>*</c-> <c- n>ratio</c-><c- p>)</c-></span><span class="line-no" data-line="10"></span><span class="line">    <c- n>ncells</c-> <c- o>=</c-> <c- n>base</c-> <c- o>-</c-> <c- n>base</c-> <c- o>%</c-> <c- n>blocking_factor</c-></span><span class="line-no" data-line="11"></span><span class="line">    <c- k>return</c-> <c- n>ncells</c-></span><span class="line-no" data-line="12"></span><span class="line"></span><span class="line-no" data-line="13"></span><span class="line"><c- n>xlower</c-> <c- o>=</c-> <c- mf>0.0</c-></span><span class="line-no" data-line="14"></span><span class="line"><c- n>xupper</c-> <c- o>=</c-> <c- mf>0.23</c-></span><span class="line-no" data-line="15"></span><span class="line"><c- n>xlen</c-> <c- o>=</c-> <c- n>xupper</c-> <c- o>-</c-> <c- n>xlower</c-></span><span class="line-no" data-line="16"></span><span class="line"></span><span class="line-no" data-line="17"></span><span class="line"><c- n>ylower</c-> <c- o>=</c-> <c- o>-</c-><c- mf>0.05</c-> <c- o>+</c-> <c- mf>0.005</c-></span><span class="line-no" data-line="18"></span><span class="line"><c- n>yupper</c-> <c- o>=</c-> <c- o>+</c-><c- mf>0.05</c-> <c- o>+</c-> <c- mf>0.005</c-></span><span class="line-no" data-line="19"></span><span class="line"><c- n>ylen</c-> <c- o>=</c-> <c- n>yupper</c-> <c- o>-</c-> <c- n>ylower</c-></span><span class="line-no" data-line="20"></span><span class="line"><c- n>blocking_factor</c-> <c- o>=</c-> <c- mi>8</c-></span><span class="line-no" data-line="21"></span><span class="line"><c- n>nx</c-> <c- o>=</c-> <c- mi>800</c-></span><span class="line-no" data-line="22"></span><span class="line"><c- n>ny</c-> <c- o>=</c-> <c- n>nCellsY</c-><c- p>(</c-><c- n>nx</c-><c- p>,</c-> <c- n>ylen</c-> <c- o>/</c-> <c- n>xlen</c-><c- p>,</c-> <c- n>blocking_factor</c-><c- o>=</c-><c- n>blocking_factor</c-><c- p>)</c-></span><span class="line-no" data-line="23"></span><span class="line"><c- n>n_level</c-> <c- o>=</c-> <c- mi>1</c-></span><span class="line-no" data-line="24"></span><span class="line"><c- n>n_error_buf</c-> <c- o>=</c-> <c- mi>0</c-> <c- k>if</c-> <c- n>n_level</c-> <c- o>==</c-> <c- mi>1</c-> <c- k>else</c-> <c- mi>1</c-></span><span class="line-no" data-line="25"></span><span class="line"></span><span class="line-no" data-line="26"></span><span class="line"><c- c1># The output files are written in this directory from the perspective of this </c-></span><span class="line-no" data-line="27"></span><span class="line"><c- c1># docker container</c-></span><span class="line-no" data-line="28"></span><span class="line"><c- n>base_path</c-> <c- o>=</c-> <c- t>'/home/amrex'</c-></span><span class="line-no" data-line="29"></span><span class="line"></span><span class="line-no" data-line="30"></span><span class="line"><c- c1>############################################################################</c-></span><span class="line-no" data-line="31"></span><span class="line"><c- c1># These variables and dictionaries will be read by the application</c-></span><span class="line-no" data-line="32"></span><span class="line"></span><span class="line-no" data-line="33"></span><span class="line"><c- c1>#Equation = {</c-></span><span class="line-no" data-line="34"></span><span class="line">  <c- c1># 'gamma': 1.4,</c-></span><span class="line-no" data-line="35"></span><span class="line">  <c- c1># 'Rspec': 287</c-></span><span class="line-no" data-line="36"></span><span class="line"><c- c1>#}</c-></span><span class="line-no" data-line="37"></span><span class="line"></span><span class="line-no" data-line="38"></span><span class="line"><c- n>RunOptions</c-> <c- o>=</c-> <c- p>{</c-></span><span class="line-no" data-line="39"></span><span class="line">  <c- t>'cfl'</c-><c- p>:</c-> <c- mf>0.8</c-><c- p>,</c-></span><span class="line-no" data-line="40"></span><span class="line">  <c- t>'final_time'</c-><c- p>:</c-> <c- mf>1e-3</c-><c- p>,</c-></span><span class="line-no" data-line="41"></span><span class="line">  <c- t>'do_backup'</c-><c- p>:</c-> <c- kc>False</c-><c- p>,</c-></span><span class="line-no" data-line="42"></span><span class="line">  <c- t>'max_cycles'</c-><c- p>:</c-> <c- o>-</c-><c- mi>1</c-><c- p>,</c-> <c- c1># -1 means infinite and 0 means only initial condition</c-></span><span class="line-no" data-line="43"></span><span class="line"><c- p>}</c-></span><span class="line-no" data-line="44"></span><span class="line"></span><span class="line-no" data-line="45"></span><span class="line"><c- c1># This option defines the Mach number of the shock</c-></span><span class="line-no" data-line="46"></span><span class="line"><c- c1># Default is 1.1</c-></span><span class="line-no" data-line="47"></span><span class="line"><c- n>Mach_number</c-> <c- o>=</c-> <c- mf>1.1</c-></span><span class="line-no" data-line="48"></span><span class="line"></span><span class="line-no" data-line="49"></span><span class="line"><c- n>reconstruction</c-> <c- o>=</c-> <c- u>"Characteristics"</c-></span><span class="line-no" data-line="50"></span><span class="line"></span><span class="line-no" data-line="51"></span><span class="line"><c- n>GridGeometry</c-> <c- o>=</c-> <c- p>{</c-></span><span class="line-no" data-line="52"></span><span class="line">  <c- c1># This option tells the solver how many cells to use</c-></span><span class="line-no" data-line="53"></span><span class="line">  <c- t>'cell_dimensions'</c-><c- p>:</c-> <c- p>[</c-><c- n>nx</c-><c- p>,</c-> <c- n>ny</c-><c- p>,</c-> <c- mi>1</c-><c- p>],</c-></span><span class="line-no" data-line="54"></span><span class="line">  <c- c1># This option defines the coordinates of the computational domain</c-></span><span class="line-no" data-line="55"></span><span class="line">  <c- t>'coordinates'</c-><c- p>:</c-> <c- p>{</c-></span><span class="line-no" data-line="56"></span><span class="line">    <c- t>'lower'</c-><c- p>:</c-> <c- p>[</c-><c- n>xlower</c-><c- p>,</c-> <c- n>ylower</c-><c- p>,</c-> <c- o>+</c-><c- mf>0.00</c-><c- p>],</c-></span><span class="line-no" data-line="57"></span><span class="line">    <c- t>'upper'</c-><c- p>:</c-> <c- p>[</c-><c- n>xupper</c-><c- p>,</c-> <c- n>yupper</c-><c- p>,</c-> <c- o>+</c-><c- mf>0.10</c-><c- p>],</c-></span><span class="line-no" data-line="58"></span><span class="line">  <c- p>},</c-></span><span class="line-no" data-line="59"></span><span class="line">  <c- c1># We have no periodicity in Divider</c-></span><span class="line-no" data-line="60"></span><span class="line">  <c- t>'periodicity'</c-><c- p>:</c-> <c- p>[</c-><c- mi>0</c-><c- p>,</c-> <c- mi>0</c-><c- p>,</c-> <c- mi>0</c-><c- p>]</c-></span><span class="line-no" data-line="61"></span><span class="line"><c- p>}</c-></span><span class="line-no" data-line="62"></span><span class="line"></span><span class="line-no" data-line="63"></span><span class="line"><c- c1># defines the number of ghost cells</c-></span><span class="line-no" data-line="64"></span><span class="line"><c- n>scratch_gcw</c-> <c- o>=</c-> <c- mi>2</c-> <c- k>if</c-> <c- n>n_level</c-> <c- o>==</c-> <c- mi>1</c-> <c- k>else</c-> <c- mi>4</c-></span><span class="line-no" data-line="65"></span><span class="line"></span><span class="line-no" data-line="66"></span><span class="line"><c- c1># defines the number of ghost faces</c-></span><span class="line-no" data-line="67"></span><span class="line"><c- n>flux_gcw</c-> <c- o>=</c-> <c- n>scratch_gcw</c-> <c- o>-</c-> <c- mi>2</c-></span><span class="line-no" data-line="68"></span><span class="line"></span><span class="line-no" data-line="69"></span><span class="line"><c- n>PatchHierarchy</c-> <c- o>=</c-> <c- p>{</c-></span><span class="line-no" data-line="70"></span><span class="line">  <c- c1># Defines the number of refinement levels</c-></span><span class="line-no" data-line="71"></span><span class="line">  <c- c1># 1 means no adaptive refinement</c-></span><span class="line-no" data-line="72"></span><span class="line">  <c- t>'max_number_of_levels'</c-><c- p>:</c-> <c- n>n_level</c-><c- p>,</c-></span><span class="line-no" data-line="73"></span><span class="line">  <c- c1># Set this to 1 if max_number_of_levles > 1</c-></span><span class="line-no" data-line="74"></span><span class="line">  <c- t>'n_error_buf'</c-><c- p>:</c-> <c- p>[</c-><c- n>n_error_buf</c-><c- p>,</c-> <c- n>n_error_buf</c-><c- p>,</c-> <c- n>n_error_buf</c-><c- p>],</c-></span><span class="line-no" data-line="75"></span><span class="line">  <c- c1># Defines the maximal size of a single patch</c-></span><span class="line-no" data-line="76"></span><span class="line">  <c- c1># patches can by smaller thou</c-></span><span class="line-no" data-line="77"></span><span class="line">  <c- t>'max_grid_size'</c-><c- p>:</c-> <c- p>[</c-><c- n>nx</c-><c- p>,</c-> <c- n>ny</c-><c- p>,</c-> <c- mi>1</c-><c- p>],</c-></span><span class="line-no" data-line="78"></span><span class="line">  <c- c1># Do not change this, it defines how many ghost cells are needed for the</c-></span><span class="line-no" data-line="79"></span><span class="line">  <c- c1># cut-cell geometry</c-></span><span class="line-no" data-line="80"></span><span class="line">  <c- t>'ngrow_eb_level_set'</c-><c- p>:</c-> max<c- p>(</c-><c- n>scratch_gcw</c-> <c- o>+</c-> <c- mi>1</c-><c- p>,</c-> <c- mi>9</c-><c- p>),</c-></span><span class="line-no" data-line="81"></span><span class="line">  <c- c1># If a patch is completely covered by behind cut-cells remove them from the grid</c-></span><span class="line-no" data-line="82"></span><span class="line">  <c- t>'remove_covered_grids'</c-><c- p>:</c-> <c- kc>False</c-><c- p>,</c-></span><span class="line-no" data-line="83"></span><span class="line">  <c- c1># Every patch size is a multiple of blocking_factor (in each direction)</c-></span><span class="line-no" data-line="84"></span><span class="line">  <c- c1># i.e. blocking_factor = 8 means patches have the size of 8 or 16 or 24 or ...</c-></span><span class="line-no" data-line="85"></span><span class="line">  <c- t>'blocking_factor'</c-><c- p>:</c-> <c- p>[</c-><c- n>blocking_factor</c-><c- p>,</c-> <c- n>blocking_factor</c-><c- p>,</c-> <c- n>blocking_factor</c-><c- p>],</c-></span><span class="line-no" data-line="86"></span><span class="line">  <c- c1># How many cells are needed inbetween AMR levels</c-></span><span class="line-no" data-line="87"></span><span class="line">  <c- t>'n_proper'</c-><c- p>:</c-> <c- mi>1</c-><c- p>,</c-></span><span class="line-no" data-line="88"></span><span class="line"><c- p>}</c-></span><span class="line-no" data-line="89"></span><span class="line"></span><span class="line-no" data-line="90"></span><span class="line"><c- c1># Adjust those paths to read the files that describe the wall boundaries for the Divider.</c-></span><span class="line-no" data-line="91"></span><span class="line"><c- c1># The first and the last point need within each wall file need to be equal</c-></span><span class="line-no" data-line="92"></span><span class="line"><c- n>wall_filenames</c-> <c- o>=</c-> <c- p>[</c-><c- t>'</c-><c- si>{}</c-><c- t>/wall_1.txt'</c-><c- o>.</c-><c- n>format</c-><c- p>(</c-><c- n>base_path</c-><c- p>),</c-></span><span class="line-no" data-line="93"></span><span class="line">                  <c- t>'</c-><c- si>{}</c-><c- t>/wall_2.txt'</c-><c- o>.</c-><c- n>format</c-><c- p>(</c-><c- n>base_path</c-><c- p>),</c-></span><span class="line-no" data-line="94"></span><span class="line">                  <c- t>'</c-><c- si>{}</c-><c- t>/wall_3.txt'</c-><c- o>.</c-><c- n>format</c-><c- p>(</c-><c- n>base_path</c-><c- p>)]</c-></span><span class="line-no" data-line="95"></span><span class="line"></span><span class="line-no" data-line="96"></span><span class="line"><c- c1># Defines the </c-></span><span class="line-no" data-line="97"></span><span class="line"><c- n>Output</c-> <c- o>=</c-> <c- p>{</c-></span><span class="line-no" data-line="98"></span><span class="line">	<c- t>'outputs'</c-><c- p>:</c-> <c- p>[</c-></span><span class="line-no" data-line="99"></span><span class="line">  <c- c1># Write AMReX-output directories. This output preserves the AMR hierarchy </c-></span><span class="line-no" data-line="100"></span><span class="line">  <c- c1># It is readable from Paraview, VisIt and Python</c-></span><span class="line-no" data-line="101"></span><span class="line">  <c- p>{</c-><c- t>'type'</c-><c- p>:</c-> <c- t>'Plotfiles'</c-><c- p>,</c-> <c- t>'directory'</c-><c- p>:</c-> <c- t>'Divider_DE5_</c-><c- si>{}</c-><c- t>/Plotfiles'</c-><c- o>.</c-><c- n>format</c-><c- p>(</c-><c- n>nx</c-><c- p>),</c-> <c- t>'intervals'</c-><c- p>:</c-> <c- p>[</c-><c- mf>1e-4</c-><c- p>]},</c-></span><span class="line-no" data-line="102"></span><span class="line">  <c- c1># Write simple HDF5 files</c-></span><span class="line-no" data-line="103"></span><span class="line">  <c- c1># It is faster and writes a single grid without patches</c-></span><span class="line-no" data-line="104"></span><span class="line">  <c- p>{</c-><c- t>'type'</c-><c- p>:</c-> <c- t>'HDF5'</c-><c- p>,</c-> <c- t>'path'</c-><c- p>:</c-> <c- t>'Divider_c24_</c-><c- si>{}</c-><c- t>.h5'</c-><c- o>.</c-><c- n>format</c-><c- p>(</c-><c- n>nx</c-><c- p>),</c-> <c- t>'intervals'</c-><c- p>:</c-> <c- p>[</c-><c- mf>1e-5</c-><c- p>]},</c-></span><span class="line-no" data-line="105"></span><span class="line">  <c- c1># Print out timer statistics</c-></span><span class="line-no" data-line="106"></span><span class="line">  <c- p>{</c-><c- t>'type'</c-><c- p>:</c-> <c- t>'CounterOutput'</c-><c- p>,</c-> <c- t>'intervals'</c-><c- p>:</c-> <c- p>[</c-><c- mf>1e-4</c-><c- p>]</c-> <c- p>},</c-></span><span class="line-no" data-line="107"></span><span class="line"><c- p>]</c-></span><span class="line-no" data-line="108"></span><span class="line"><c- p>}</c-></span></pre> </api-key></username>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="conformance"><span class="content"> Conformance</span><a class="self-link" href="#conformance"></a></h2>
   <p> Conformance requirements are expressed with a combination of descriptive assertions and RFC 2119 terminology.
            The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
            in the normative parts of this document
            are to be interpreted as described in RFC 2119.
            However, for readability,
            these words do not appear in all uppercase letters in this specification. </p>
   <p> All of the text of this specification is normative
            except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <p> Examples in this specification are introduced with the words “for example”
            or are set apart from the normative text with <code>class="example"</code>, like this: </p>
   <div class="example" id="example-example"><a class="self-link" href="#example-example"></a> This is an example of an informative example. </div>
   <p> Informative notes begin with the word “Note”
            and are set apart from the normative text with <code>class="note"</code>, like this: </p>
   <p class="note" role="note"> Note, this is an informative note. </p>
  </div>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">←</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">→</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">↑</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Don’t scroll to compensate for the ToC if we’re above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I don’t know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldn’t exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isn’t standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we don’t have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While we’re at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Can’t find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-amrex">[AMReX]
   <dd>Weiqun Zhang; Ann Almgren. <a href="http://github.com/AMReX-Codes/amrex">AMReX Github Project</a>. URL: <a href="http://github.com/AMReX-Codes/amrex">http://github.com/AMReX-Codes/amrex</a>
   <dt id="biblio-hdf5">[HDF5]
   <dd>Tab Atkins; Dirk Schultze. <a href="http://www.w3.org/TR/foo-bar/">Foo Bar Level 1</a>. CR. URL: <a href="http://www.w3.org/TR/foo-bar/">http://www.w3.org/TR/foo-bar/</a>
   <dt id="biblio-klein2009">[Klein2009]
   <dd>Rupert Klein; Nikiforakis. <a href="http://www.w3.org/TR/foo-bar/">Foo Bar Level 1</a>. CR. URL: <a href="http://www.w3.org/TR/foo-bar/">http://www.w3.org/TR/foo-bar/</a>
   <dt id="biblio-p4est">[P4EST]
   <dd>Tab Atkins; Dirk Schultze. <a href="http://www.w3.org/TR/foo-bar/">Foo Bar Level 1</a>. CR. URL: <a href="http://www.w3.org/TR/foo-bar/">http://www.w3.org/TR/foo-bar/</a>
   <dt id="biblio-samrai">[SAMRAI]
   <dd>Tab Atkins; Dirk Schultze. <a href="http://www.w3.org/TR/foo-bar/">Foo Bar Level 1</a>. CR. URL: <a href="http://www.w3.org/TR/foo-bar/">http://www.w3.org/TR/foo-bar/</a>
  </dl>