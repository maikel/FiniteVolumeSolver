FROM ubuntu:20.04

ARG CI_JOB_TOKEN
ENV CI_JOB_TOKEN ${CI_JOB_TOKEN}

ARG DEBIAN_FRONTEND=noninteractive
RUN apt-get update \
  && apt-get install --yes gfortran python3-pip wget libpthread-stubs0-dev git libopenmpi-dev \
                           m4 gcc-8 gcc-9 clang-7 clang-8 cmake \
  && pip3 install conan

RUN conan remote add finite-volume https://api.bintray.com/conan/fub-agklein/finite-volume \
 && conan remote add gitlab https://git.imp.fu-berlin.de/api/v4/packages/conan \
 && conan profile new linux-gcc9 --detect \
 && conan profile update settings.compiler=gcc linux-gcc9 \
 && conan profile update settings.compiler.version=9 linux-gcc9 \
 && conan profile update settings.compiler.libcxx=libstdc++11 linux-gcc9 \
 && conan profile new linux-clang8 --detect \
 && conan profile update settings.compiler=clang linux-clang8 \
 && conan profile update settings.compiler.version=8 linux-clang8 \
 && conan profile update settings.compiler.libcxx=libc++ linux-clang8 \
 && conan profile update env.CC=clang linux-clang8 \
 && conan profile update env.CXX=clang++ linux-clang8 \
 && conan user ci_user -r gitlab -p ${CI_JOB_TOKEN}

RUN conan install boost/1.71.0@conan/stable --profile linux-gcc9 --build missing \
 && conan install eigen/3.3.7@conan/stable --profile linux-gcc9 --build missing \
 && conan install pybind11/2.3.0@conan/stable --profile linux-gcc9 --build missing \
 && conan install fmt/5.3.0@bincrafters/stable --profile linux-gcc9 --build missing \
 && conan install boost/1.71.0@conan/stable --profile linux-clang8 --build missing \
 && conan install eigen/3.3.7@conan/stable --profile linux-clang8 --build missing \
 && conan install pybind11/2.3.0@conan/stable --profile linux-clang8 --build missing \
 && conan install fmt/5.3.0@bincrafters/stable --profile linux-clang8 --build missing
